{"version":3,"file":"slimselect.es.js","sources":["../src/slim-select/classes.ts","../src/slim-select/helpers.ts","../src/slim-select/store.ts","../src/slim-select/render.ts","../src/slim-select/select.ts","../src/slim-select/settings.ts","../src/slim-select/index.ts"],"sourcesContent":["export default class CssClasses {\r\n  public main: string\r\n  // Placeholder\r\n  public placeholder: string\r\n\r\n  // Values\r\n  public values: string\r\n  public single: string\r\n  public max: string\r\n  public value: string\r\n  public valueText: string\r\n  public valueDelete: string\r\n  public valueOut: string\r\n\r\n  // Deselect\r\n  public deselect: string\r\n  public deselectPath: string // Not a class but whatever\r\n\r\n  // Arrow\r\n  public arrow: string\r\n  public arrowClose: string // Not a class but whatever\r\n  public arrowOpen: string // Not a class but whatever\r\n\r\n  // Content\r\n  public content: string\r\n  public contentOpen: string\r\n  public dirAbove: string\r\n  public dirBelow: string\r\n\r\n  // Search\r\n  public search: string\r\n  public searchHighlighter: string\r\n  public searching: string\r\n  public addable: string\r\n  public addablePath: string // Not a class but whatever\r\n  public addButton: string\r\n  public addButtonPath: string // Not a class but whatever\r\n\r\n  // List optgroups/options\r\n  public list: string\r\n\r\n  // Optgroup\r\n  public optgroup: string\r\n  public optgroupLabel: string\r\n  public optgroupLabelText: string\r\n  public optgroupActions: string\r\n  public optgroupSelectAll: string // optgroup select all\r\n  public optgroupSelectAllBox: string // Not a class but whatever\r\n  public optgroupSelectAllCheck: string // Not a class but whatever\r\n  public optgroupClosable: string\r\n\r\n  // Option\r\n  public option: string\r\n  public optionDelete: string // Not a class but whatever\r\n  public highlighted: string\r\n\r\n  // Misc\r\n  public mainOpen: string\r\n  public close: string\r\n  public selected: string\r\n  public error: string\r\n  public disabled: string\r\n  public hide: string\r\n\r\n  constructor(classes?: Partial<CssClasses>) {\r\n    if (!classes) {\r\n      classes = {}\r\n    }\r\n\r\n    let join = (a = '', b = '') => `${a} ${b}`.trim()\r\n\r\n    this.main = join('ss-main', classes.main)\r\n    this.placeholder = join('ss-placeholder', classes.placeholder)\r\n    this.values = join('ss-values', classes.values)\r\n    this.single = join('ss-single', classes.single)\r\n    this.max = join('ss-max', classes.max)\r\n    this.value = join('ss-value', classes.value)\r\n    this.valueText = join('ss-value-text', classes.valueText)\r\n    this.valueDelete = join('ss-value-delete', classes.valueDelete)\r\n    this.valueOut = join('ss-value-out', classes.valueOut)\r\n\r\n    this.deselect = join('ss-deselect', classes.deselect)\r\n    this.deselectPath = classes.deselectPath || 'M10,10 L90,90 M10,90 L90,10'\r\n    this.arrow = join('ss-arrow', classes.arrow)\r\n    this.arrowClose = classes.arrowClose || 'M10,30 L50,70 L90,30'\r\n    this.arrowOpen = classes.arrowOpen || 'M10,70 L50,30 L90,70'\r\n    this.content = join('ss-content', classes.content)\r\n    this.contentOpen = join('ss-open', classes.contentOpen)\r\n    this.dirAbove = join('ss-dir-above', classes.dirAbove)\r\n    this.dirBelow = join('ss-dir-below', classes.dirBelow)\r\n    this.search = join('ss-search', classes.search)\r\n    this.searchHighlighter = join('ss-search-highlight', classes.searchHighlighter)\r\n    this.searching = join('ss-searching', classes.searching)\r\n    this.addable = join('ss-addable', classes.addable)\r\n    this.addablePath = classes.addablePath || 'M50,10 L50,90 M10,50 L90,50'\r\n    this.addButton = join('ss-add-button', classes.addButton)\r\n    this.addButtonPath = classes.addButtonPath || 'M50,10 L50,90 M10,50 L90,50'\r\n    this.list = join('ss-list', classes.list)\r\n    this.optgroup = join('ss-optgroup', classes.optgroup)\r\n    this.optgroupLabel = join('ss-optgroup-label', classes.optgroupLabel)\r\n    this.optgroupLabelText = join('ss-optgroup-label-text', classes.optgroupLabelText)\r\n    this.optgroupActions = join('ss-optgroup-actions', classes.optgroupActions)\r\n    this.optgroupSelectAll = join('ss-selectall', classes.optgroupSelectAll)\r\n    this.optgroupSelectAllBox = classes.optgroupSelectAllBox || 'M60,10 L10,10 L10,90 L90,90 L90,50'\r\n    this.optgroupSelectAllCheck = classes.optgroupSelectAllCheck || 'M30,45 L50,70 L90,10'\r\n    this.optgroupClosable = join('ss-closable', classes.optgroupClosable)\r\n    this.option = join('ss-option', classes.option)\r\n    this.optionDelete = classes.optionDelete || 'M10,10 L90,90 M10,90 L90,10'\r\n    this.highlighted = join('ss-highlighted', classes.highlighted)\r\n    this.mainOpen = join('ss-open', classes.mainOpen)\r\n    this.close = join('ss-close', classes.close)\r\n    this.selected = join('ss-selected', classes.selected)\r\n    this.error = join('ss-error', classes.error)\r\n    this.disabled = join('ss-disabled', classes.disabled)\r\n    this.hide = join('ss-hide', classes.hide)\r\n  }\r\n\r\n  public getFirst(name: keyof Omit<CssClasses, 'getFirst'>): string {\r\n    return this[name].split(' ')[0]\r\n  }\r\n}\r\n","// Generate an 8 character random string\r\nexport function generateID(): string {\r\n  return Math.random().toString(36).substring(2, 10)\r\n}\r\n\r\nexport function hasClassInTree(element: HTMLElement, className: string): HTMLElement | null {\r\n  function hasClass(e: HTMLElement, c: string) {\r\n    // If the element has the class return element\r\n    if (c && e && e.classList && e.classList.contains(c)) {\r\n      return e\r\n    }\r\n\r\n    // If the element has a dataset id of the class return element\r\n    if (c && e && e.dataset && e.dataset.id && e.dataset.id === className) {\r\n      return e\r\n    }\r\n\r\n    return null\r\n  }\r\n\r\n  function parentByClass(e: any, c: string): any {\r\n    if (!e || e === (document as any)) {\r\n      return null\r\n    } else if (hasClass(e, c)) {\r\n      return e\r\n    } else {\r\n      return parentByClass(e.parentNode, c)\r\n    }\r\n  }\r\n\r\n  return hasClass(element, className) || parentByClass(element, className)\r\n}\r\n\r\n// debounce will call the last requested function after the wait time\r\nexport function debounce<T extends (...args: any[]) => void>(func: T, wait = 50, immediate = false): () => void {\r\n  let timeout: any\r\n  return function (this: any, ...args: any[]): void {\r\n    const context = self\r\n    const later = () => {\r\n      timeout = null\r\n      if (!immediate) {\r\n        func.apply(context, args)\r\n      }\r\n    }\r\n    const callNow = immediate && !timeout\r\n    clearTimeout(timeout)\r\n    timeout = setTimeout(later, wait)\r\n    if (callNow) {\r\n      func.apply(context, args)\r\n    }\r\n  }\r\n}\r\n\r\nexport function isEqual(a: any, b: any): boolean {\r\n  return JSON.stringify(a) === JSON.stringify(b)\r\n}\r\n\r\nexport function kebabCase(str: string): string {\r\n  const result = str.replace(/[A-Z\\u00C0-\\u00D6\\u00D8-\\u00DE]/g, (match) => '-' + match.toLowerCase())\r\n  return str[0] === str[0].toUpperCase() ? result.substring(1) : result\r\n}\r\n","import { generateID } from './helpers'\r\n\r\nexport class Option {\r\n  id: string\r\n  value: string\r\n  text: string\r\n  html: string\r\n  defaultSelected: boolean\r\n  selected: boolean\r\n  display: boolean\r\n  disabled: boolean\r\n  placeholder: boolean\r\n  class: string\r\n  style: string\r\n  data: { [key: string]: string }\r\n  mandatory: boolean\r\n\r\n  constructor(option: Partial<Option>) {\r\n    this.id = !option.id || option.id === '' ? generateID() : option.id\r\n    this.value = option.value === undefined ? option.text || '' : option.value || ''\r\n    this.text = option.text || ''\r\n    this.html = option.html || ''\r\n    this.defaultSelected = option.defaultSelected !== undefined ? option.defaultSelected : false\r\n    this.selected = option.selected !== undefined ? option.selected : false\r\n    this.display = option.display !== undefined ? option.display : true\r\n    this.disabled = option.disabled !== undefined ? option.disabled : false\r\n    this.mandatory = option.mandatory !== undefined ? option.mandatory : false\r\n    this.placeholder = option.placeholder !== undefined ? option.placeholder : false\r\n    this.class = option.class || ''\r\n    this.style = option.style || ''\r\n    this.data = option.data || {}\r\n  }\r\n}\r\nexport class Optgroup {\r\n  public id: string\r\n  public label: string\r\n  public selectAll: boolean\r\n  public selectAllText: string\r\n  public closable: 'off' | 'open' | 'close'\r\n  public options: Partial<Option>[]\r\n\r\n  constructor(optgroup: Partial<Optgroup>) {\r\n    this.id = !optgroup.id || optgroup.id === '' ? generateID() : optgroup.id\r\n    this.label = optgroup.label || ''\r\n    this.selectAll = optgroup.selectAll === undefined ? false : optgroup.selectAll\r\n    this.selectAllText = optgroup.selectAllText || 'Select All'\r\n    this.closable = optgroup.closable || 'off'\r\n\r\n    // If options exist, loop through options and create new option class\r\n    // and set the options to the optgroup options field\r\n    this.options = []\r\n    if (optgroup.options) {\r\n      for (const o of optgroup.options) {\r\n        this.options.push(new Option(o))\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport default class Store {\r\n  private selectType: 'single' | 'multiple' = 'single'\r\n\r\n  // Main data set, never null\r\n  private data: (Option | Optgroup)[] = []\r\n  private selectedOrder: string[] = []\r\n\r\n  constructor(type: 'single' | 'multiple', data: (Partial<Option> | Partial<Optgroup>)[]) {\r\n    this.selectType = type\r\n    this.setData(data)\r\n  }\r\n\r\n  // Validate DataArrayPartial\r\n  public validateDataArray(data: (Partial<Option> | Partial<Optgroup>)[]): Error | null {\r\n    if (!Array.isArray(data)) {\r\n      return new Error('Data must be an array')\r\n    }\r\n\r\n    // Loop through each data object\r\n    for (let dataObj of data) {\r\n      if (!dataObj) continue\r\n\r\n      // Optgroup\r\n      if (dataObj instanceof Optgroup || 'label' in dataObj) {\r\n        if (!('label' in dataObj)) {\r\n          return new Error('Optgroup must have a label')\r\n        }\r\n\r\n        if ('options' in dataObj && dataObj.options) {\r\n          for (let option of dataObj.options) {\r\n            const validationError = this.validateOption(option)\r\n            if (validationError) {\r\n              return validationError\r\n            }\r\n          }\r\n        }\r\n      } else if (dataObj instanceof Option || 'text' in dataObj) {\r\n        const validationError = this.validateOption(dataObj)\r\n        if (validationError) {\r\n          return validationError\r\n        }\r\n      } else {\r\n        return new Error('Data object must be a valid optgroup or option')\r\n      }\r\n    }\r\n\r\n    return null\r\n  }\r\n\r\n  // Validate Option\r\n  public validateOption(option: Partial<Option>): Error | null {\r\n    if (!('text' in option)) {\r\n      return new Error('Option must have a text')\r\n    }\r\n\r\n    return null\r\n  }\r\n\r\n  public partialToFullData(data: (Partial<Option> | Partial<Optgroup>)[]): (Option | Optgroup)[] {\r\n    let dataFinal: (Option | Optgroup)[] = []\r\n    data.forEach((dataObj) => {\r\n      if (!dataObj) return\r\n\r\n      // Optgroup\r\n      if (dataObj instanceof Optgroup || 'label' in dataObj) {\r\n        let optOptions: Option[] = []\r\n        if ('options' in dataObj && dataObj.options) {\r\n          dataObj.options.forEach((option: Partial<Option>) => {\r\n            optOptions.push(new Option(option))\r\n          })\r\n        }\r\n\r\n        if (optOptions.length > 0) {\r\n          dataFinal.push(new Optgroup(dataObj as Partial<Optgroup>))\r\n        }\r\n      }\r\n\r\n      // Option\r\n      if (dataObj instanceof Option || 'text' in dataObj) {\r\n        dataFinal.push(new Option(dataObj as Partial<Option>))\r\n      }\r\n    })\r\n\r\n    return dataFinal\r\n  }\r\n\r\n  public setData(data: (Partial<Option> | Partial<Optgroup>)[], preserveSelected: boolean = false) {\r\n    // Convert new data to full data array\r\n    const newData = this.partialToFullData(data)\r\n\r\n    if (preserveSelected) {\r\n      // Get currently selected options before updating data\r\n      const selectedOptions = this.getSelectedOptions()\r\n\r\n      // Check which selected options are missing from new data\r\n      const missingSelected: (Option | Optgroup)[] = []\r\n      selectedOptions.forEach((selectedOption) => {\r\n        let found = false\r\n\r\n        // Check if this selected option exists in new data\r\n        for (const newItem of newData) {\r\n          if (newItem instanceof Option && newItem.id === selectedOption.id) {\r\n            found = true\r\n            break\r\n          }\r\n          if (newItem instanceof Optgroup) {\r\n            for (const opt of newItem.options) {\r\n              if (opt.id === selectedOption.id) {\r\n                found = true\r\n                break\r\n              }\r\n            }\r\n          }\r\n        }\r\n\r\n        if (!found) {\r\n          missingSelected.push(selectedOption)\r\n        }\r\n      })\r\n\r\n      // Add missing selected options to the beginning of the data\r\n      this.data = [...missingSelected, ...newData]\r\n    } else {\r\n      this.data = newData\r\n    }\r\n\r\n    // Run this.data through setSelected by value\r\n    // to set the selected property and clean any wrong selected\r\n    if (this.selectType === 'single') {\r\n      this.setSelectedBy('id', this.getSelected())\r\n    }\r\n  }\r\n\r\n  // Get data will return all the data\r\n  public getData(): Option[] | Optgroup[] {\r\n    return this.filter(null, true) as Option[] | Optgroup[]\r\n  }\r\n\r\n  // Get data options will return the data as a\r\n  // flat array of just options\r\n  public getDataOptions(): Option[] {\r\n    return this.filter(null, false) as Option[]\r\n  }\r\n\r\n  public addOption(option: Partial<Option>, addToStart: boolean = false) {\r\n    if (addToStart) {\r\n      let data = [new Option(option)] as (Option | Optgroup)[]\r\n      this.setData(data.concat(this.getData()))\r\n    } else {\r\n      this.setData(this.getData().concat(new Option(option)))\r\n    }\r\n  }\r\n\r\n  // Pass in an array of id that will loop through\r\n  // each option and set the selected property to true\r\n  // but also clean selected by determining selectType\r\n  public setSelectedBy(selectedType: 'id' | 'value', selectedValues: string[]) {\r\n    let firstOption: Partial<Option> | null = null\r\n    let hasSelected = false\r\n    const selectedObjects: Partial<Option>[] = []\r\n\r\n    for (let dataObj of this.data) {\r\n      // Optgroup\r\n      if (dataObj instanceof Optgroup) {\r\n        for (let option of dataObj.options as Partial<Option>[]) {\r\n          if (!firstOption) {\r\n            firstOption = option\r\n          }\r\n\r\n          let optionValue = option[selectedType] || ''\r\n          option.selected = hasSelected ? false : selectedValues.includes(optionValue)\r\n\r\n          // If the option is selected, set hasSelected to true\r\n          // for single based selects\r\n          if (option.selected) {\r\n            selectedObjects.push(option)\r\n\r\n            if (this.selectType === 'single') {\r\n              hasSelected = true\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      // Option\r\n      if (dataObj instanceof Option) {\r\n        if (!firstOption) {\r\n          firstOption = dataObj\r\n        }\r\n\r\n        dataObj.selected = hasSelected ? false : selectedValues.includes(dataObj[selectedType])\r\n\r\n        // If the option is selected, set hasSelected to true\r\n        // for single based selects\r\n        if (dataObj.selected) {\r\n          selectedObjects.push(dataObj)\r\n\r\n          if (this.selectType === 'single') {\r\n            hasSelected = true\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    // If no options are selected, select the first option\r\n    if (this.selectType === 'single' && firstOption && !hasSelected) {\r\n      firstOption.selected = true\r\n      selectedObjects.push(firstOption)\r\n    }\r\n\r\n    // Put together a list of selected ids in the order of the selected values\r\n    const selectedIds = selectedValues.map((value) => {\r\n      return selectedObjects.find((option) => option[selectedType] === value)?.id || ''\r\n    })\r\n\r\n    this.selectedOrder = selectedIds\r\n  }\r\n\r\n  public getSelected(): string[] {\r\n    return this.getSelectedOptions().map((option) => option.id)\r\n  }\r\n\r\n  public getSelectedValues(): string[] {\r\n    return this.getSelectedOptions().map((option) => option.value)\r\n  }\r\n\r\n  public getSelectedOptions(): Option[] {\r\n    return this.filter((opt: Option) => {\r\n      return opt.selected\r\n    }, false) as Option[]\r\n  }\r\n\r\n  public getOptgroupByID(id: string): Optgroup | null {\r\n    // Loop through each data object\r\n    // and if optgroup is found, return it\r\n    for (let dataObj of this.data) {\r\n      if (dataObj instanceof Optgroup && dataObj.id === id) {\r\n        return dataObj\r\n      }\r\n    }\r\n\r\n    return null\r\n  }\r\n\r\n  public getOptionByID(id: string): Option | null {\r\n    let options = this.filter((opt: Option) => {\r\n      return opt.id === id\r\n    }, false) as Option[]\r\n\r\n    return options.length ? options[0] : null\r\n  }\r\n\r\n  public getSelectType(): string {\r\n    return this.selectType\r\n  }\r\n\r\n  public getFirstOption(): Option | null {\r\n    let option: Option | null = null\r\n    for (let dataObj of this.data) {\r\n      if (dataObj instanceof Optgroup) {\r\n        option = dataObj.options[0] as Option\r\n      } else if (dataObj instanceof Option) {\r\n        option = dataObj\r\n      }\r\n\r\n      if (option) {\r\n        break\r\n      }\r\n    }\r\n    return option\r\n  }\r\n\r\n  // Take in search string and return filtered list of values\r\n  public search(search: string, searchFilter: (opt: Option, search: string) => boolean): (Option | Optgroup)[] {\r\n    search = search.trim()\r\n\r\n    // If search is empty, return all data\r\n    if (search === '') {\r\n      return this.getData()\r\n    }\r\n\r\n    // Run filter with search function\r\n    return this.filter((opt: Option): boolean => {\r\n      return searchFilter(opt, search)\r\n    }, true)\r\n  }\r\n\r\n  // Filter takes in a function that will be used to filter the data\r\n  // This will also keep optgroups of sub options meet the filter requirements\r\n  public filter(filter: { (opt: Option): boolean } | null, includeOptgroup: boolean): (Option | Optgroup)[] {\r\n    const dataSearch: (Option | Optgroup)[] = []\r\n    this.data.forEach((dataObj: Option | Optgroup) => {\r\n      // Optgroup\r\n      if (dataObj instanceof Optgroup) {\r\n        let optOptions: Option[] = []\r\n        let options = dataObj.options as Option[]\r\n        options.forEach((option: Option) => {\r\n          if (!filter || filter(option as Option)) {\r\n            // If you dont want to include optgroups\r\n            // just push to the dataSearch array\r\n            if (!includeOptgroup) {\r\n              dataSearch.push(new Option(option))\r\n            } else {\r\n              optOptions.push(new Option(option))\r\n            }\r\n          }\r\n        })\r\n\r\n        // If we pushed any options to the optOptions array\r\n        // push the optgroup to the dataSearch array\r\n        if (optOptions.length > 0) {\r\n          // Create new optgroup with the new options\r\n          let optgroup = new Optgroup(dataObj)\r\n          optgroup.options = optOptions\r\n\r\n          // Push optgroup to dataSearch\r\n          dataSearch.push(optgroup)\r\n        }\r\n      }\r\n\r\n      // Option\r\n      if (dataObj instanceof Option) {\r\n        if (!filter || filter(dataObj)) {\r\n          dataSearch.push(new Option(dataObj))\r\n        }\r\n      }\r\n    })\r\n\r\n    return dataSearch\r\n  }\r\n\r\n  // Take in an array of options and reoder them based upon the selected order\r\n  public selectedOrderOptions(options: Option[]): Option[] {\r\n    const newOrder: Option[] = []\r\n    this.selectedOrder.forEach((id) => {\r\n      const option = options.find((opt) => opt.id === id)\r\n      if (option) {\r\n        newOrder.push(option)\r\n      }\r\n    })\r\n\r\n    // add any remaining options that were not in the selected order\r\n    options.forEach((option) => {\r\n      let isIn = false\r\n      newOrder.forEach((selectedOption) => {\r\n        if (option.id === selectedOption.id) {\r\n          isIn = true\r\n\r\n          return\r\n        }\r\n      })\r\n\r\n      if (!isIn) {\r\n        newOrder.push(option)\r\n      }\r\n    })\r\n\r\n    return newOrder\r\n  }\r\n}\r\n","import { debounce } from './helpers'\r\nimport Settings from './settings'\r\nimport Store, { Optgroup, Option } from './store'\r\nimport CssClasses from './classes'\r\n\r\nexport interface Callbacks {\r\n  open: () => void\r\n  close: () => void\r\n  addable?: (\r\n    value: string\r\n  ) => Promise<Partial<Option> | string> | Partial<Option> | string | false | undefined | null | Error\r\n  addButton?: () => void\r\n  setSelected: (value: string | string[], runAfterChange: boolean) => void\r\n  addOption: (option: Option) => void\r\n  search: (search: string) => void\r\n  beforeChange?: (newVal: Option[], oldVal: Option[]) => boolean | void\r\n  afterChange?: (newVal: Option[]) => void\r\n}\r\n\r\nexport interface Main {\r\n  main: HTMLDivElement\r\n  values: HTMLDivElement\r\n  deselect: {\r\n    main: HTMLDivElement\r\n    svg: SVGSVGElement\r\n    path: SVGPathElement\r\n  }\r\n  arrow: {\r\n    main: SVGSVGElement\r\n    path: SVGPathElement\r\n  }\r\n}\r\n\r\nexport interface Content {\r\n  main: HTMLDivElement\r\n  search: Search\r\n  list: HTMLDivElement\r\n  addButton?: AddButton\r\n}\r\n\r\nexport interface AddButton {\r\n  main: HTMLDivElement\r\n  svg: SVGSVGElement\r\n  path: SVGPathElement\r\n  text?: HTMLSpanElement\r\n}\r\n\r\nexport interface Search {\r\n  main: HTMLDivElement\r\n  input: HTMLInputElement\r\n  addable?: {\r\n    main: HTMLDivElement\r\n    svg: SVGSVGElement\r\n    path: SVGPathElement\r\n  }\r\n}\r\n\r\nexport default class Render {\r\n  public settings: Settings\r\n  public store: Store\r\n  public callbacks: Callbacks\r\n\r\n  // Used to compute the range selection\r\n  private lastSelectedOption: Option | null\r\n\r\n  // Timeout tracking for cleanup\r\n  private closeAnimationTimeout: ReturnType<typeof setTimeout> | null = null\r\n\r\n  // Elements\r\n  public main: Main\r\n  public content: Content\r\n\r\n  // Classes\r\n  public classes: CssClasses\r\n\r\n  constructor(settings: Required<Settings>, classes: Required<CssClasses>, store: Store, callbacks: Callbacks) {\r\n    this.store = store\r\n    this.settings = settings\r\n    this.classes = classes\r\n    this.callbacks = callbacks\r\n    this.lastSelectedOption = null\r\n\r\n    this.main = this.mainDiv()\r\n    this.content = this.contentDiv()\r\n\r\n    // Add classes and styles to main/content\r\n    this.updateClassStyles()\r\n    this.updateAriaAttributes()\r\n\r\n    // Position content off-screen initially to prevent scrollbars\r\n    // This must be after updateClassStyles() since it removes all style attributes\r\n    // The main element isn't in the DOM yet, so getBoundingClientRect() would return zeros\r\n    // Once opened, moveContent() will position it correctly\r\n    if (this.settings.contentPosition !== 'relative') {\r\n      this.content.main.style.top = '-9999px'\r\n      this.content.main.style.left = '-9999px'\r\n      this.content.main.style.margin = '0'\r\n      this.content.main.style.width = 'auto'\r\n    }\r\n\r\n    // Add content to the content location settings\r\n    if (this.settings.contentLocation) {\r\n      this.settings.contentLocation.appendChild(this.content.main)\r\n    }\r\n  }\r\n\r\n  // Helper method to add classes that may contain spaces\r\n  // Splits by spaces and adds each class individually to avoid DOMException\r\n  private addClasses(element: HTMLElement | SVGElement, classValue: string): void {\r\n    if (!classValue || classValue.trim() === '') {\r\n      return\r\n    }\r\n    const classes = classValue.split(' ').filter((c) => c.trim() !== '')\r\n    for (const cls of classes) {\r\n      element.classList.add(cls.trim())\r\n    }\r\n  }\r\n\r\n  // Helper method to remove classes that may contain spaces\r\n  private removeClasses(element: HTMLElement | SVGElement, classValue: string): void {\r\n    if (!classValue || classValue.trim() === '') {\r\n      return\r\n    }\r\n    const classes = classValue.split(' ').filter((c) => c.trim() !== '')\r\n    for (const cls of classes) {\r\n      element.classList.remove(cls.trim())\r\n    }\r\n  }\r\n\r\n  // Remove disabled classes\r\n  public enable(): void {\r\n    // Remove disabled class\r\n    this.removeClasses(this.main.main, this.classes.disabled)\r\n    this.main.main.setAttribute('aria-disabled', 'false')\r\n\r\n    // Set search input to \"enabled\"\r\n    this.content.search.input.disabled = false\r\n  }\r\n\r\n  // Set disabled classes\r\n  public disable(): void {\r\n    // Add disabled class\r\n    this.addClasses(this.main.main, this.classes.disabled)\r\n    this.main.main.setAttribute('aria-disabled', 'true')\r\n\r\n    // Set search input to disabled\r\n    this.content.search.input.disabled = true\r\n  }\r\n\r\n  public open(): void {\r\n    this.main.arrow.path.setAttribute('d', this.classes.arrowOpen)\r\n    this.main.main.setAttribute('aria-expanded', 'true')\r\n\r\n    // Clear any pending close animation timeout to prevent race conditions\r\n    if (this.closeAnimationTimeout) {\r\n      clearTimeout(this.closeAnimationTimeout)\r\n      this.closeAnimationTimeout = null\r\n    }\r\n\r\n    // Set direction class on both main and content (persists, never removed)\r\n    const isAbove = this.settings.openPosition === 'up'\r\n    const dirClass = isAbove ? this.classes.dirAbove : this.classes.dirBelow\r\n    this.addClasses(this.main.main, dirClass)\r\n    this.addClasses(this.content.main, dirClass)\r\n\r\n    // Add open class to content to trigger open animation\r\n    this.addClasses(this.content.main, this.classes.contentOpen)\r\n\r\n    // Make search visible to screen readers when opened\r\n    this.content.search.input.removeAttribute('aria-hidden')\r\n\r\n    // move the content in to the right location\r\n    this.moveContent()\r\n\r\n    // Move to last selected option\r\n    const selectedOptions = this.store.getSelectedOptions()\r\n    if (selectedOptions.length) {\r\n      const selectedId = selectedOptions[selectedOptions.length - 1].id\r\n      const selectedOption = this.content.list.querySelector('[data-id=\"' + selectedId + '\"]') as HTMLElement\r\n      if (selectedOption) {\r\n        this.ensureElementInView(this.content.list, selectedOption)\r\n      }\r\n    }\r\n  }\r\n\r\n  public close(): void {\r\n    this.main.main.setAttribute('aria-expanded', 'false')\r\n    this.main.arrow.path.setAttribute('d', this.classes.arrowClose)\r\n\r\n    // Remove open class from content to trigger close animation\r\n    // Direction class (dirAbove/dirBelow) persists to maintain correct transform-origin\r\n    this.removeClasses(this.content.main, this.classes.contentOpen)\r\n\r\n    // Hide search from screen readers when closed\r\n    this.content.search.input.setAttribute('aria-hidden', 'true')\r\n\r\n    // Clear active descendant when closed\r\n    this.main.main.removeAttribute('aria-activedescendant')\r\n\r\n    // Remove direction class from main and content after animation is complete\r\n    const animationTiming = this.getAnimationTiming()\r\n    this.closeAnimationTimeout = setTimeout(() => {\r\n      this.removeClasses(this.main.main, this.classes.dirAbove)\r\n      this.removeClasses(this.main.main, this.classes.dirBelow)\r\n      this.removeClasses(this.content.main, this.classes.dirAbove)\r\n      this.removeClasses(this.content.main, this.classes.dirBelow)\r\n      this.closeAnimationTimeout = null\r\n    }, animationTiming)\r\n  }\r\n\r\n  private getAnimationTiming(): number {\r\n    const computedStyle = getComputedStyle(this.content.main)\r\n    const cssValue = computedStyle.getPropertyValue('--ss-animation-timing').trim()\r\n\r\n    if (cssValue) {\r\n      // Parse CSS time value (e.g., \"0.2s\" or \"200ms\")\r\n      if (cssValue.endsWith('ms')) {\r\n        return parseFloat(cssValue)\r\n      } else if (cssValue.endsWith('s')) {\r\n        return parseFloat(cssValue) * 1000\r\n      }\r\n    }\r\n\r\n    // Fall back to default 200ms\r\n    return 200\r\n  }\r\n\r\n  public updateClassStyles(): void {\r\n    // Clear all classes and styles\r\n    this.main.main.className = ''\r\n    this.main.main.removeAttribute('style')\r\n    this.content.main.className = ''\r\n    this.content.main.removeAttribute('style')\r\n\r\n    // Make sure main/content has its base class\r\n    this.addClasses(this.main.main, this.classes.main)\r\n    this.addClasses(this.content.main, this.classes.content)\r\n\r\n    // Add styles\r\n    if (this.settings.style !== '') {\r\n      this.main.main.style.cssText = this.settings.style\r\n      this.content.main.style.cssText = this.settings.style\r\n    }\r\n\r\n    // Add classes\r\n    if (this.settings.class.length) {\r\n      for (const c of this.settings.class) {\r\n        if (c.trim() !== '') {\r\n          this.main.main.classList.add(c.trim())\r\n          this.content.main.classList.add(c.trim())\r\n        }\r\n      }\r\n    }\r\n\r\n    // Misc classes\r\n    // Add content position class\r\n    if (this.settings.contentPosition === 'relative' || this.settings.contentPosition === 'fixed') {\r\n      this.content.main.classList.add('ss-' + this.settings.contentPosition)\r\n    }\r\n  }\r\n\r\n  public updateAriaAttributes() {\r\n    const listboxId = this.content.list.id\r\n\r\n    // Main combobox\r\n    this.main.main.role = 'combobox'\r\n    this.main.main.setAttribute('aria-haspopup', 'listbox')\r\n    this.main.main.setAttribute('aria-controls', listboxId)\r\n    this.main.main.setAttribute('aria-expanded', 'false')\r\n\r\n    this.content.list.setAttribute('role', 'listbox')\r\n    this.content.list.setAttribute('aria-label', this.settings.ariaLabel + ' listbox')\r\n\r\n    // Add aria-multiselectable for multiple selects\r\n    if (this.settings.isMultiple) {\r\n      this.content.list.setAttribute('aria-multiselectable', 'true')\r\n    }\r\n\r\n    // Search input should also control the listbox\r\n    this.content.search.input.setAttribute('aria-controls', listboxId)\r\n  }\r\n\r\n  public mainDiv(): Main {\r\n    // Create main container\r\n    const main = document.createElement('div')\r\n\r\n    // Add id to data-id\r\n    main.dataset.id = this.settings.id\r\n    // main.id = this.settings.id+'-main' // Remove for now as it is not needed and add duplicate id errors\r\n\r\n    // Add label\r\n    main.setAttribute('aria-label', this.settings.ariaLabel)\r\n\r\n    // Set tabable to allow tabbing to the element\r\n    main.tabIndex = 0\r\n\r\n    // Deal with keyboard events on the main div\r\n    // This is to allow for normal selecting\r\n    // when you may not have a search bar\r\n    main.onkeydown = (e: KeyboardEvent): boolean => {\r\n      // Convert above if else statemets to switch\r\n      switch (e.key) {\r\n        case 'ArrowUp':\r\n        case 'ArrowDown':\r\n          this.callbacks.open()\r\n          e.key === 'ArrowDown' ? this.highlight('down') : this.highlight('up')\r\n          return false\r\n        case 'Tab':\r\n          this.callbacks.close()\r\n          return true // Continue doing normal tabbing\r\n        case 'Enter':\r\n        case ' ':\r\n          this.callbacks.open()\r\n          const highlighted = this.content.list.querySelector(\r\n            '.' + this.classes.getFirst('highlighted')\r\n          ) as HTMLDivElement\r\n          if (highlighted) {\r\n            highlighted.click()\r\n          }\r\n          return false\r\n        case 'Escape':\r\n          this.callbacks.close()\r\n          return false\r\n      }\r\n\r\n      // Check if they type a-z, A-Z and 0-9\r\n      if (e.key.length === 1) {\r\n        this.callbacks.open()\r\n      }\r\n\r\n      return true\r\n    }\r\n\r\n    // Add onclick for main div\r\n    main.onclick = (e: Event): void => {\r\n      // Dont do anything if disabled\r\n      if (this.settings.disabled) {\r\n        return\r\n      }\r\n\r\n      this.settings.isOpen ? this.callbacks.close() : this.callbacks.open()\r\n    }\r\n\r\n    // Add values\r\n    const values = document.createElement('div')\r\n    this.addClasses(values, this.classes.values)\r\n    main.appendChild(values)\r\n\r\n    // Add deselect\r\n    const deselect = document.createElement('div')\r\n    this.addClasses(deselect, this.classes.deselect)\r\n\r\n    // Check if deselect is to be shown or not\r\n    const selectedOptions = this.store?.getSelectedOptions()\r\n    if (!this.settings.allowDeselect || (this.settings.isMultiple && selectedOptions && selectedOptions.length <= 0)) {\r\n      this.addClasses(deselect, this.classes.hide)\r\n    } else {\r\n      this.removeClasses(deselect, this.classes.hide)\r\n    }\r\n\r\n    // Add deselect onclick event\r\n    deselect.onclick = (e: Event) => {\r\n      e.stopPropagation()\r\n\r\n      // Dont do anything if disabled\r\n      if (this.settings.disabled) {\r\n        return\r\n      }\r\n\r\n      // By Default we will delete\r\n      let shouldDelete = true\r\n      const before = this.store.getSelectedOptions()\r\n      const after = [] as Option[]\r\n\r\n      // Add beforeChange callback\r\n      if (this.callbacks.beforeChange) {\r\n        shouldDelete = this.callbacks.beforeChange(after, before) === true\r\n      }\r\n\r\n      if (shouldDelete) {\r\n        if (this.settings.isMultiple) {\r\n          this.callbacks.setSelected([], false)\r\n          this.updateDeselectAll()\r\n        } else {\r\n          // Get first option and set it as selected\r\n          const firstOption = this.store.getFirstOption()\r\n          const id = firstOption ? firstOption.id : ''\r\n\r\n          this.callbacks.setSelected(id, false)\r\n        }\r\n\r\n        // Check if we need to close the dropdown\r\n        if (this.settings.closeOnSelect) {\r\n          this.callbacks.close()\r\n        }\r\n\r\n        // Run afterChange callback\r\n        if (this.callbacks.afterChange) {\r\n          this.callbacks.afterChange(this.store.getSelectedOptions())\r\n        }\r\n      }\r\n    }\r\n\r\n    // Add deselect svg\r\n    const deselectSvg = document.createElementNS('http://www.w3.org/2000/svg', 'svg')\r\n    deselectSvg.setAttribute('viewBox', '0 0 100 100')\r\n    const deselectPath = document.createElementNS('http://www.w3.org/2000/svg', 'path')\r\n    deselectPath.setAttribute('d', this.classes.deselectPath)\r\n    deselectSvg.appendChild(deselectPath)\r\n    deselect.appendChild(deselectSvg)\r\n    main.appendChild(deselect)\r\n\r\n    // Add arrow\r\n    const arrow = document.createElementNS('http://www.w3.org/2000/svg', 'svg')\r\n    this.addClasses(arrow, this.classes.arrow)\r\n    arrow.setAttribute('viewBox', '0 0 100 100')\r\n    const arrowPath = document.createElementNS('http://www.w3.org/2000/svg', 'path')\r\n    arrowPath.setAttribute('d', this.classes.arrowClose)\r\n    if (this.settings.alwaysOpen) {\r\n      this.addClasses(arrow, this.classes.hide)\r\n    }\r\n    arrow.appendChild(arrowPath)\r\n    main.appendChild(arrow)\r\n\r\n    return {\r\n      main: main,\r\n      values: values,\r\n      deselect: {\r\n        main: deselect,\r\n        svg: deselectSvg,\r\n        path: deselectPath\r\n      },\r\n      arrow: {\r\n        main: arrow,\r\n        path: arrowPath\r\n      }\r\n    }\r\n  }\r\n\r\n  public mainFocus(eventType: string | null): void {\r\n    // Trigger focus but dont scroll to it\r\n    // Need for prevent refocus the element if event is not keyboard event.\r\n    // For example if event is mouse click or tachpad click this condition prevent refocus on element\r\n    // because click by mouse change focus position and not need return focus to element.\r\n    if (eventType !== 'click') {\r\n      this.main.main.focus({ preventScroll: true })\r\n    }\r\n  }\r\n\r\n  public placeholder(): HTMLDivElement {\r\n    // Figure out if there is a placeholder option\r\n    const placeholderOption = this.store.filter((o) => o.placeholder, false) as Option[]\r\n\r\n    // If there is a placeholder option use that\r\n    // If placeholder has an html value, use that\r\n    // If placeholder has a text, use that\r\n    // If nothing is set, use the placeholder text\r\n    let placeholderText = this.settings.placeholderText\r\n    if (placeholderOption.length) {\r\n      if (placeholderOption[0].html !== '') {\r\n        placeholderText = placeholderOption[0].html\r\n      } else if (placeholderOption[0].text !== '') {\r\n        placeholderText = placeholderOption[0].text\r\n      }\r\n    }\r\n\r\n    // Create placeholder div\r\n    const placeholder = document.createElement('div')\r\n    this.addClasses(placeholder, this.classes.placeholder)\r\n    placeholder.innerHTML = placeholderText\r\n    return placeholder\r\n  }\r\n\r\n  // Get selected values and append to multiSelected values container\r\n  // and remove those who shouldnt exist\r\n  public renderValues(): void {\r\n    // If single select set placeholder or selected value\r\n    if (!this.settings.isMultiple) {\r\n      this.renderSingleValue()\r\n      return\r\n    }\r\n\r\n    this.renderMultipleValues()\r\n\r\n    this.updateDeselectAll()\r\n  }\r\n\r\n  private renderSingleValue(): void {\r\n    const selected = this.store.filter((o: Option): boolean => {\r\n      return o.selected && !o.placeholder\r\n    }, false) as Option[]\r\n    const selectedSingle = selected.length > 0 ? selected[0] : null\r\n\r\n    // If nothing is seleected use settings placeholder text\r\n    if (!selectedSingle) {\r\n      this.main.values.innerHTML = this.placeholder().outerHTML\r\n    } else {\r\n      // Create single value container\r\n      const singleValue = document.createElement('div')\r\n      this.addClasses(singleValue, this.classes.single)\r\n      if (selectedSingle.html) {\r\n        singleValue.innerHTML = selectedSingle.html\r\n      } else {\r\n        singleValue.innerText = selectedSingle.text\r\n      }\r\n\r\n      // If there is a selected value, set a single div\r\n      this.main.values.innerHTML = singleValue.outerHTML\r\n    }\r\n\r\n    // If allowDeselect is false or selected value is empty just hide deselect\r\n    if (!this.settings.allowDeselect || !selected.length) {\r\n      this.addClasses(this.main.deselect.main, this.classes.hide)\r\n    } else {\r\n      this.removeClasses(this.main.deselect.main, this.classes.hide)\r\n    }\r\n  }\r\n\r\n  private renderMultipleValues(): void {\r\n    // Get various pieces of data\r\n    let currentNodes = this.main.values.childNodes as NodeListOf<HTMLDivElement>\r\n    let selectedOptions = this.store.filter((opt: Option) => {\r\n      // Only grab options that are selected and display is true\r\n      return opt.selected && opt.display\r\n    }, false) as Option[]\r\n\r\n    // If selectedOptions is empty set placeholder\r\n    if (selectedOptions.length === 0) {\r\n      this.main.values.innerHTML = this.placeholder().outerHTML\r\n      return\r\n    } else {\r\n      // If there is a placeholder, remove it\r\n      const placeholder = this.main.values.querySelector('.' + this.classes.getFirst('placeholder'))\r\n      if (placeholder) {\r\n        placeholder.remove()\r\n      }\r\n    }\r\n\r\n    // If selectedOptions is greater than maxItems, set maxValuesMessage\r\n    if (selectedOptions.length > this.settings.maxValuesShown) {\r\n      // Creating the element that shows the number of selected items\r\n      const singleValue = document.createElement('div')\r\n      this.addClasses(singleValue, this.classes.max)\r\n      singleValue.textContent = this.settings.maxValuesMessage.replace('{number}', selectedOptions.length.toString())\r\n\r\n      // If there is a selected value, set a single div\r\n      this.main.values.innerHTML = singleValue.outerHTML\r\n      return\r\n    } else {\r\n      // If there is a message, remove it\r\n      const maxValuesMessage = this.main.values.querySelector('.' + this.classes.getFirst('max'))\r\n      if (maxValuesMessage) {\r\n        maxValuesMessage.remove()\r\n      }\r\n    }\r\n\r\n    // Lets check for data selected order\r\n    if (this.settings.keepOrder) {\r\n      selectedOptions = this.store.selectedOrderOptions(selectedOptions)\r\n    }\r\n\r\n    // Loop through currentNodes and only include ones that are not in selectedIDs\r\n    let removeNodes: HTMLDivElement[] = []\r\n    for (let i = 0; i < currentNodes.length; i++) {\r\n      const node = currentNodes[i]\r\n      const id = node.getAttribute('data-id')\r\n      if (id) {\r\n        // Check if id is in selectedOptions\r\n        const found = selectedOptions.filter((opt: Option) => {\r\n          return opt.id === id\r\n        }, false)\r\n\r\n        // If not found, add to removeNodes\r\n        if (!found.length) {\r\n          removeNodes.push(node)\r\n        }\r\n      }\r\n    }\r\n\r\n    // Loop through and remove\r\n    for (const n of removeNodes) {\r\n      this.addClasses(n, this.classes.valueOut)\r\n      setTimeout(() => {\r\n        if (this.main.values.hasChildNodes() && this.main.values.contains(n)) {\r\n          this.main.values.removeChild(n)\r\n        }\r\n      }, 100)\r\n    }\r\n\r\n    // Add values that dont currently exist\r\n    currentNodes = this.main.values.childNodes as NodeListOf<HTMLDivElement>\r\n    for (let d = 0; d < selectedOptions.length; d++) {\r\n      let shouldAdd = true\r\n      for (let i = 0; i < currentNodes.length; i++) {\r\n        if (selectedOptions[d].id === String(currentNodes[i].dataset.id)) {\r\n          shouldAdd = false\r\n        }\r\n      }\r\n\r\n      // If shouldAdd, insertAdjacentElement it to the values container in the order of the selectedOptions\r\n      if (shouldAdd) {\r\n        // If keepOrder is true, we will just append it to the end\r\n        if (this.settings.keepOrder) {\r\n          this.main.values.appendChild(this.multipleValue(selectedOptions[d]))\r\n        } else {\r\n          // else we will insert it in the order of the selectedOptions\r\n          if (currentNodes.length === 0) {\r\n            this.main.values.appendChild(this.multipleValue(selectedOptions[d]))\r\n          } else if (d === 0) {\r\n            this.main.values.insertBefore(this.multipleValue(selectedOptions[d]), currentNodes[d])\r\n          } else {\r\n            currentNodes[d - 1].insertAdjacentElement('afterend', this.multipleValue(selectedOptions[d]))\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  public multipleValue(option: Option): HTMLDivElement {\r\n    const value = document.createElement('div')\r\n    this.addClasses(value, this.classes.value)\r\n    value.dataset.id = option.id\r\n\r\n    const text = document.createElement('div')\r\n    this.addClasses(text, this.classes.valueText)\r\n    text.textContent = option.text // For multiple values always use text\r\n    value.appendChild(text)\r\n\r\n    // Only add deletion if the option is not mandatory\r\n    if (!option.mandatory) {\r\n      // Create delete div element\r\n      const deleteDiv = document.createElement('div')\r\n      this.addClasses(deleteDiv, this.classes.valueDelete)\r\n      deleteDiv.setAttribute('tabindex', '0') // Make the div focusable for tab navigation\r\n\r\n      // Add delete onclick event\r\n      deleteDiv.onclick = (e: Event) => {\r\n        e.preventDefault()\r\n        e.stopPropagation()\r\n\r\n        // Dont do anything if disabled\r\n        if (this.settings.disabled) {\r\n          return\r\n        }\r\n\r\n        // By Default we will delete\r\n        let shouldDelete = true\r\n        const before = this.store.getSelectedOptions()\r\n        const after = before.filter((o) => {\r\n          return o.selected && o.id !== option.id\r\n        }, true)\r\n\r\n        // Check if minSelected is set and if after length so, return\r\n        if (this.settings.minSelected && after.length < this.settings.minSelected) {\r\n          return\r\n        }\r\n\r\n        // If there is a beforeDeselect function run it\r\n        if (this.callbacks.beforeChange) {\r\n          shouldDelete = this.callbacks.beforeChange(after, before) === true\r\n        }\r\n\r\n        if (shouldDelete) {\r\n          // Loop through after and append ids to a variable called selected\r\n          let selectedIds: string[] = []\r\n          for (const o of after) {\r\n            if (o instanceof Optgroup) {\r\n              for (const c of o.options) {\r\n                if (c.id) {\r\n                  selectedIds.push(c.id)\r\n                }\r\n              }\r\n            }\r\n\r\n            if (o instanceof Option) {\r\n              selectedIds.push(o.id)\r\n            }\r\n          }\r\n          this.callbacks.setSelected(selectedIds, false)\r\n\r\n          // Check if we need to close the dropdown\r\n          if (this.settings.closeOnSelect) {\r\n            this.callbacks.close()\r\n          }\r\n\r\n          // Run afterChange callback\r\n          if (this.callbacks.afterChange) {\r\n            this.callbacks.afterChange(after)\r\n          }\r\n\r\n          this.updateDeselectAll()\r\n        }\r\n      }\r\n\r\n      // Add delete svg\r\n      const deleteSvg = document.createElementNS('http://www.w3.org/2000/svg', 'svg')\r\n      deleteSvg.setAttribute('viewBox', '0 0 100 100')\r\n      const deletePath = document.createElementNS('http://www.w3.org/2000/svg', 'path')\r\n      deletePath.setAttribute('d', this.classes.optionDelete)\r\n      deleteSvg.appendChild(deletePath)\r\n      deleteDiv.appendChild(deleteSvg)\r\n\r\n      value.appendChild(deleteDiv)\r\n\r\n      // Add keydown event listener for keyboard navigation (Enter key)\r\n      deleteDiv.onkeydown = (e) => {\r\n        if (e.key === 'Enter') {\r\n          deleteDiv.click() // Trigger the click event when Enter is pressed\r\n        }\r\n      }\r\n    }\r\n\r\n    return value\r\n  }\r\n\r\n  public contentDiv(): Content {\r\n    const main = document.createElement('div')\r\n\r\n    // Add id to data-id\r\n    main.dataset.id = this.settings.id\r\n    // main.id = this.settings.id + '-content' // Remove for now as it is not needed and add duplicate id errors\r\n\r\n    // Add search\r\n    const search = this.searchDiv()\r\n    main.appendChild(search.main)\r\n\r\n    // Add list\r\n    const list = this.listDiv()\r\n    main.appendChild(list)\r\n\r\n    // Add add-button\r\n    let contentAdd: AddButton | undefined = undefined\r\n    if (this.callbacks.addButton) {\r\n      contentAdd = this.addButtonDiv()\r\n      main.appendChild(contentAdd.main)\r\n    }\r\n\r\n    return {\r\n      main: main,\r\n      search: search,\r\n      list: list,\r\n      addButton: contentAdd\r\n    }\r\n  }\r\n\r\n  // Create content add button element\r\n  public addButtonDiv(): AddButton {\r\n    const main = document.createElement('div')\r\n    this.addClasses(main, this.classes.addButton)\r\n\r\n    const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg')\r\n    svg.setAttribute('viewBox', '0 0 100 100')\r\n    const path = document.createElementNS('http://www.w3.org/2000/svg', 'path')\r\n    path.setAttribute('d', this.classes.addButtonPath)\r\n    svg.appendChild(path)\r\n    main.appendChild(svg)\r\n\r\n    let textEl: HTMLSpanElement | undefined\r\n    if (this.settings.addButtonText && this.settings.addButtonText !== '') {\r\n      textEl = document.createElement('span')\r\n      textEl.textContent = this.settings.addButtonText\r\n      textEl.className = 'ss-add-button-text'\r\n      main.appendChild(textEl)\r\n    }\r\n\r\n    main.onclick = (e: Event) => {\r\n      e.preventDefault()\r\n      e.stopPropagation()\r\n      if (this.callbacks.addButton) {\r\n        this.callbacks.addButton()\r\n        // Close the dropdown after executing the callback\r\n        this.callbacks.close()\r\n      }\r\n    }\r\n\r\n    return {\r\n      main,\r\n      svg,\r\n      path,\r\n      text: textEl\r\n    }\r\n  }\r\n\r\n  public moveContent(): void {\r\n    // If contentPosition is relative, dont move the content anywhere other than below\r\n    if (this.settings.contentPosition === 'relative') {\r\n      this.moveContentBelow()\r\n      return\r\n    }\r\n\r\n    // If openContent is not auto set content\r\n    if (this.settings.openPosition === 'down') {\r\n      this.moveContentBelow()\r\n      return\r\n    } else if (this.settings.openPosition === 'up') {\r\n      this.moveContentAbove()\r\n      return\r\n    }\r\n\r\n    // Auto - Determine where to put the content\r\n    if (this.putContent() === 'up') {\r\n      this.moveContentAbove()\r\n    } else {\r\n      this.moveContentBelow()\r\n    }\r\n  }\r\n\r\n  public searchDiv(): Search {\r\n    const main = document.createElement('div')\r\n    const input = document.createElement('input')\r\n    const addable = document.createElement('div')\r\n    this.addClasses(main, this.classes.search)\r\n\r\n    // Setup search return object\r\n    const searchReturn: Search = {\r\n      main,\r\n      input\r\n    }\r\n\r\n    // We still want the search to be tabable but not shown\r\n    if (!this.settings.showSearch) {\r\n      this.addClasses(main, this.classes.hide)\r\n      input.readOnly = true\r\n    }\r\n\r\n    input.type = 'search'\r\n    input.placeholder = this.settings.searchPlaceholder\r\n    input.tabIndex = -1\r\n    input.setAttribute('aria-label', this.settings.searchPlaceholder)\r\n    input.setAttribute('aria-autocomplete', 'list')\r\n    input.setAttribute('autocapitalize', 'off')\r\n    input.setAttribute('autocomplete', 'off')\r\n    input.setAttribute('autocorrect', 'off')\r\n    // Hide from screen readers by default (shown when opened)\r\n    input.setAttribute('aria-hidden', 'true')\r\n\r\n    input.oninput = debounce((e: Event) => {\r\n      this.callbacks.search((e.target as HTMLInputElement).value)\r\n    }, 100)\r\n\r\n    // Deal with keyboard events on search input field\r\n    input.onkeydown = (e: KeyboardEvent): boolean => {\r\n      // Convert above if else statemets to switch\r\n      switch (e.key) {\r\n        case 'ArrowUp':\r\n        case 'ArrowDown':\r\n          e.key === 'ArrowDown' ? this.highlight('down') : this.highlight('up')\r\n          return false\r\n        case 'Tab':\r\n          // When tabbing close the dropdown\r\n          // which will also focus on main div\r\n          // and then continuing normal tabbing\r\n          this.callbacks.close()\r\n          return true // Continue doing normal tabbing\r\n        case 'Escape':\r\n          this.callbacks.close()\r\n          return false\r\n        case ' ':\r\n          const highlighted = this.content.list.querySelector(\r\n            '.' + this.classes.getFirst('highlighted')\r\n          ) as HTMLDivElement\r\n          if (highlighted) {\r\n            highlighted.click()\r\n            return false\r\n          }\r\n          return true\r\n        case 'Enter':\r\n          // Check if there's a highlighted option first\r\n          const highlightedEnter = this.content.list.querySelector(\r\n            '.' + this.classes.getFirst('highlighted')\r\n          ) as HTMLDivElement\r\n          if (highlightedEnter) {\r\n            // If an option is highlighted, select it (even if addable is enabled)\r\n            highlightedEnter.click()\r\n            return false\r\n          } else if (this.callbacks.addable) {\r\n            // If no option is highlighted and addable is enabled, add new item\r\n            addable.click()\r\n            return false\r\n          }\r\n          return true\r\n      }\r\n\r\n      return true // Allow normal typing\r\n    }\r\n\r\n    main.appendChild(input)\r\n\r\n    // If addable is enabled, add the addable div\r\n    if (this.callbacks.addable) {\r\n      // Add main class\r\n      this.addClasses(addable, this.classes.addable)\r\n\r\n      // Add svg icon\r\n      const plus = document.createElementNS('http://www.w3.org/2000/svg', 'svg')\r\n      plus.setAttribute('viewBox', '0 0 100 100')\r\n      const plusPath = document.createElementNS('http://www.w3.org/2000/svg', 'path')\r\n      plusPath.setAttribute('d', this.classes.addablePath)\r\n      plus.appendChild(plusPath)\r\n      addable.appendChild(plus)\r\n\r\n      // Add click event to addable div\r\n      addable.onclick = (e: Event) => {\r\n        e.preventDefault()\r\n        e.stopPropagation()\r\n\r\n        // Do nothing if addable is not set\r\n        if (!this.callbacks.addable) {\r\n          return\r\n        }\r\n\r\n        // Grab input value\r\n        const inputValue = this.content.search.input.value.trim()\r\n        if (inputValue === '') {\r\n          this.content.search.input.focus()\r\n          return\r\n        }\r\n\r\n        // Run finish will be ran at the end of the addable function.\r\n        // Reason its in a function is so we can run it after the\r\n        // addable function is done for promise based addables\r\n        const runFinish = (oo: Partial<Option>) => {\r\n          let newOption = new Option(oo)\r\n\r\n          // Call addOption to add the new option\r\n          this.callbacks.addOption(newOption)\r\n\r\n          // set selected value for single and multiple\r\n          if (this.settings.isMultiple) {\r\n            let ids = this.store.getSelected()\r\n            ids.push(newOption.id)\r\n            this.callbacks.setSelected(ids, true)\r\n          } else {\r\n            this.callbacks.setSelected([newOption.id], true)\r\n          }\r\n\r\n          // Clear search\r\n          this.callbacks.search('')\r\n\r\n          // Close it only if closeOnSelect = true\r\n          if (this.settings.closeOnSelect) {\r\n            setTimeout(() => {\r\n              // Give it a little padding for a better looking animation\r\n              this.callbacks.close()\r\n            }, 100)\r\n          }\r\n        }\r\n\r\n        // Call addable callback\r\n        const addableValue = this.callbacks.addable(inputValue)\r\n\r\n        // If addableValue is false, undefined or null, do nothing\r\n        if (addableValue === false || addableValue === undefined || addableValue === null) {\r\n          return\r\n        }\r\n\r\n        // If addableValue is a promise, wait for it to resolve\r\n        if (addableValue instanceof Promise) {\r\n          addableValue.then((value) => {\r\n            if (typeof value === 'string') {\r\n              runFinish({\r\n                text: value,\r\n                value: value\r\n              })\r\n            } else if (addableValue instanceof Error) {\r\n              this.renderError(addableValue.message)\r\n            } else {\r\n              runFinish(value)\r\n            }\r\n          })\r\n        } else if (typeof addableValue === 'string') {\r\n          runFinish({\r\n            text: addableValue,\r\n            value: addableValue\r\n          })\r\n        } else if (addableValue instanceof Error) {\r\n          this.renderError(addableValue.message)\r\n        } else {\r\n          runFinish(addableValue)\r\n        }\r\n\r\n        return\r\n      }\r\n      main.appendChild(addable)\r\n\r\n      // Add the addable to the search return\r\n      searchReturn.addable = {\r\n        main: addable,\r\n        svg: plus,\r\n        path: plusPath\r\n      }\r\n    }\r\n\r\n    return searchReturn\r\n  }\r\n\r\n  public searchFocus(): void {\r\n    this.content.search.input.focus({ preventScroll: true })\r\n  }\r\n\r\n  public getOptions(notPlaceholder = false, notDisabled = false, notHidden = false): HTMLDivElement[] {\r\n    // Put together query string\r\n    let query = '.' + this.classes.getFirst('option')\r\n    if (notPlaceholder) {\r\n      query += ':not(.' + this.classes.getFirst('placeholder') + ')'\r\n    }\r\n    if (notDisabled) {\r\n      query += ':not(.' + this.classes.getFirst('disabled') + ')'\r\n    }\r\n    if (notHidden) {\r\n      query += ':not(.' + this.classes.getFirst('hide') + ')'\r\n    }\r\n\r\n    return Array.from(this.content.list.querySelectorAll(query))\r\n  }\r\n\r\n  // highlightUp is used to highlight the previous option in the list\r\n  public highlight(dir: 'up' | 'down'): void {\r\n    // Get full list of options in list\r\n    const options = this.getOptions(true, true, true)\r\n\r\n    // If there are no options, do nothing\r\n    if (options.length === 0) {\r\n      return\r\n    }\r\n\r\n    // If length is 1, highlight it\r\n    if (options.length === 1) {\r\n      // Check if option doesnt already have highlighted class\r\n      if (!options[0].classList.contains(this.classes.getFirst('highlighted'))) {\r\n        this.addClasses(options[0], this.classes.highlighted)\r\n        return\r\n      }\r\n    }\r\n\r\n    // Loop through options and see if there are no highlighted ones\r\n    let highlighted = false\r\n    for (const o of options) {\r\n      if (o.classList.contains(this.classes.getFirst('highlighted'))) {\r\n        highlighted = true\r\n      }\r\n    }\r\n\r\n    // If no highlighted, see if any are selected and if so highlight selected first one\r\n    if (!highlighted) {\r\n      for (const o of options) {\r\n        if (o.classList.contains(this.classes.getFirst('selected'))) {\r\n          this.addClasses(o, this.classes.highlighted)\r\n          break\r\n        }\r\n      }\r\n    }\r\n\r\n    // Loop through options and find the highlighted one\r\n    for (let i = 0; i < options.length; i++) {\r\n      // Found highlighted option\r\n      if (options[i].classList.contains(this.classes.getFirst('highlighted'))) {\r\n        const prevOption = options[i]\r\n        // Remove highlighted class from current one\r\n        this.removeClasses(prevOption, this.classes.highlighted)\r\n\r\n        // If previous option has parent classes ss-optgroup with ss-open then click it\r\n        const prevParent = prevOption.parentElement\r\n        if (prevParent && prevParent.classList.contains(this.classes.getFirst('mainOpen'))) {\r\n          const optgroupLabel = prevParent.querySelector('.' + this.classes.getFirst('optgroupLabel')) as HTMLDivElement\r\n          if (optgroupLabel) {\r\n            optgroupLabel.click()\r\n          }\r\n        }\r\n\r\n        // Highlight the next one\r\n        let selectOption =\r\n          options[dir === 'down' ? (i + 1 < options.length ? i + 1 : 0) : i - 1 >= 0 ? i - 1 : options.length - 1]\r\n        this.addClasses(selectOption, this.classes.highlighted)\r\n        this.ensureElementInView(this.content.list, selectOption)\r\n\r\n        // Update aria-activedescendant for screen readers\r\n        if (selectOption.id) {\r\n          this.main.main.setAttribute('aria-activedescendant', selectOption.id)\r\n        }\r\n\r\n        // If selected option has parent classes ss-optgroup with ss-close then click it\r\n        const selectParent = selectOption.parentElement\r\n        if (selectParent && selectParent.classList.contains(this.classes.getFirst('close'))) {\r\n          const optgroupLabel = selectParent.querySelector(\r\n            '.' + this.classes.getFirst('optgroupLabel')\r\n          ) as HTMLDivElement\r\n          if (optgroupLabel) {\r\n            optgroupLabel.click()\r\n          }\r\n        }\r\n\r\n        return\r\n      }\r\n    }\r\n\r\n    // If we get here, there is no highlighted option\r\n    // So we will highlight the first or last based upon direction\r\n    const firstHighlight = options[dir === 'down' ? 0 : options.length - 1]\r\n    this.addClasses(firstHighlight, this.classes.highlighted)\r\n\r\n    // Update aria-activedescendant for screen readers\r\n    if (firstHighlight.id) {\r\n      this.main.main.setAttribute('aria-activedescendant', firstHighlight.id)\r\n    }\r\n\r\n    // Scroll to highlighted one\r\n    this.ensureElementInView(this.content.list, firstHighlight)\r\n  }\r\n\r\n  // Create main container that options will reside\r\n  public listDiv(): HTMLDivElement {\r\n    const options = document.createElement('div')\r\n    this.addClasses(options, this.classes.list)\r\n\r\n    // Add id for ARIA controls reference\r\n    const listId = this.settings.id + '-list'\r\n    options.id = listId\r\n    options.dataset.id = listId\r\n\r\n    return options\r\n  }\r\n\r\n  public renderError(error: string) {\r\n    // Clear out innerHtml\r\n    this.content.list.innerHTML = ''\r\n\r\n    const errorDiv = document.createElement('div')\r\n    this.addClasses(errorDiv, this.classes.error)\r\n    errorDiv.textContent = error\r\n    this.content.list.appendChild(errorDiv)\r\n  }\r\n\r\n  public renderSearching() {\r\n    // Clear out innerHtml\r\n    this.content.list.innerHTML = ''\r\n\r\n    const searchingDiv = document.createElement('div')\r\n    this.addClasses(searchingDiv, this.classes.searching)\r\n    searchingDiv.textContent = this.settings.searchingText\r\n    this.content.list.appendChild(searchingDiv)\r\n  }\r\n\r\n  // Take in data and add options to\r\n  public renderOptions(data: (Option | Optgroup)[]): void {\r\n    // Clear out innerHtml\r\n    this.content.list.innerHTML = ''\r\n\r\n    // If no results show no results text\r\n    if (data.length === 0) {\r\n      const noResults = document.createElement('div')\r\n      this.addClasses(noResults, this.classes.search)\r\n\r\n      //\r\n      if (this.callbacks.addable) {\r\n        noResults.innerHTML = this.settings.addableText.replace('{value}', this.content.search.input.value)\r\n      } else {\r\n        noResults.innerHTML = this.settings.searchText\r\n      }\r\n      this.content.list.appendChild(noResults)\r\n      return\r\n    }\r\n\r\n    // If settings has allowDeselect and isSingle, add empty placeholder in the event they want to deselect\r\n    if (this.settings.allowDeselect && !this.settings.isMultiple) {\r\n      // Check if store options have a placeholder\r\n      const placeholderOption = this.store.filter((o) => o.placeholder, false) as Option[]\r\n      if (!placeholderOption.length) {\r\n        this.store.addOption(\r\n          new Option({\r\n            text: '',\r\n            value: '',\r\n            selected: false,\r\n            placeholder: true\r\n          }),\r\n          true\r\n        )\r\n      }\r\n    }\r\n\r\n    // Append individual options to div container\r\n    const fragment = document.createDocumentFragment()\r\n    for (const d of data) {\r\n      // Create optgroup\r\n      if (d instanceof Optgroup) {\r\n        // Create optgroup\r\n        const optgroupEl = document.createElement('div')\r\n        this.addClasses(optgroupEl, this.classes.optgroup)\r\n\r\n        // Create label\r\n        const optgroupLabel = document.createElement('div')\r\n        this.addClasses(optgroupLabel, this.classes.optgroupLabel)\r\n        optgroupEl.appendChild(optgroupLabel)\r\n\r\n        // Create label text div element\r\n        const optgroupLabelText = document.createElement('div')\r\n        this.addClasses(optgroupLabelText, this.classes.optgroupLabelText)\r\n        optgroupLabelText.textContent = d.label\r\n        optgroupLabel.appendChild(optgroupLabelText)\r\n\r\n        // Create options container\r\n        const optgroupActions = document.createElement('div')\r\n        this.addClasses(optgroupActions, this.classes.optgroupActions)\r\n        optgroupLabel.appendChild(optgroupActions)\r\n\r\n        // If selectByGroup is true and isMultiple then add click event to label\r\n        if (this.settings.isMultiple && d.selectAll) {\r\n          // Create new div to hold a checkbox svg\r\n          const selectAll = document.createElement('div')\r\n          this.addClasses(selectAll, this.classes.optgroupSelectAll)\r\n\r\n          // Check options and if all are selected, if so add class selected\r\n          let allSelected = true\r\n          for (const o of d.options) {\r\n            if (!o.selected) {\r\n              allSelected = false\r\n              break\r\n            }\r\n          }\r\n\r\n          // Add class if all selected\r\n          if (allSelected) {\r\n            this.addClasses(selectAll, this.classes.selected)\r\n          }\r\n\r\n          // Add select all text span\r\n          const selectAllText = document.createElement('span')\r\n          selectAllText.textContent = d.selectAllText\r\n          selectAll.appendChild(selectAllText)\r\n\r\n          // Create new svg for checkbox\r\n          const selectAllSvg = document.createElementNS('http://www.w3.org/2000/svg', 'svg')\r\n          selectAllSvg.setAttribute('viewBox', '0 0 100 100')\r\n          selectAll.appendChild(selectAllSvg)\r\n\r\n          // Create new path for box\r\n          const selectAllBox = document.createElementNS('http://www.w3.org/2000/svg', 'path')\r\n          selectAllBox.setAttribute('d', this.classes.optgroupSelectAllBox)\r\n          selectAllSvg.appendChild(selectAllBox)\r\n\r\n          // Create new path for check\r\n          const selectAllCheck = document.createElementNS('http://www.w3.org/2000/svg', 'path')\r\n          selectAllCheck.setAttribute('d', this.classes.optgroupSelectAllCheck)\r\n          selectAllSvg.appendChild(selectAllCheck)\r\n\r\n          // Add click event listener to select all\r\n          selectAll.addEventListener('click', (e: MouseEvent) => {\r\n            e.preventDefault()\r\n            e.stopPropagation()\r\n\r\n            // Get the store current selected values\r\n            const currentSelected = this.store.getSelected()\r\n\r\n            // If all selected, remove all options from selected\r\n            // call setSelected and return\r\n            if (allSelected) {\r\n              // Put together new list minus all options in this optgroup\r\n              const newSelected = currentSelected.filter((s) => {\r\n                for (const o of d.options) {\r\n                  if (s === o.id) {\r\n                    return false\r\n                  }\r\n                }\r\n\r\n                return true\r\n              })\r\n\r\n              this.callbacks.setSelected(newSelected, true)\r\n              return\r\n            } else {\r\n              // Put together new list with all options in this optgroup\r\n              let optionIds = d.options.map((o) => o.id).filter((id) => id !== undefined)\r\n              const newSelected = currentSelected.concat(optionIds)\r\n\r\n              // Loop through options and if they don't exist in the store\r\n              // run addOption callback\r\n              for (const o of d.options) {\r\n                if (o.id && !this.store.getOptionByID(o.id)) {\r\n                  this.callbacks.addOption(new Option(o))\r\n                }\r\n              }\r\n\r\n              this.callbacks.setSelected(newSelected, true)\r\n              return\r\n            }\r\n          })\r\n\r\n          // Append select all to label\r\n          optgroupActions.appendChild(selectAll)\r\n        }\r\n\r\n        // If optgroup has collapsable\r\n        if (d.closable !== 'off') {\r\n          // Create new div to hold a checkbox svg\r\n          const optgroupClosable = document.createElement('div')\r\n          this.addClasses(optgroupClosable, this.classes.optgroupClosable)\r\n\r\n          // Create svg arrow\r\n          const optgroupClosableSvg = document.createElementNS('http://www.w3.org/2000/svg', 'svg')\r\n          optgroupClosableSvg.setAttribute('viewBox', '0 0 100 100')\r\n          this.addClasses(optgroupClosableSvg, this.classes.arrow)\r\n          optgroupClosable.appendChild(optgroupClosableSvg)\r\n\r\n          // Create new path for arrow\r\n          const optgroupClosableArrow = document.createElementNS('http://www.w3.org/2000/svg', 'path')\r\n          optgroupClosableSvg.appendChild(optgroupClosableArrow)\r\n\r\n          // If any options are selected or someone is searching, set optgroup to open\r\n          if (d.options.some((o) => o.selected) || this.content.search.input.value.trim() !== '') {\r\n            this.addClasses(optgroupClosable, this.classes.mainOpen)\r\n            optgroupClosableArrow.setAttribute('d', this.classes.arrowOpen)\r\n          } else if (d.closable === 'open') {\r\n            this.addClasses(optgroupEl, this.classes.mainOpen)\r\n            optgroupClosableArrow.setAttribute('d', this.classes.arrowOpen)\r\n          } else if (d.closable === 'close') {\r\n            this.addClasses(optgroupEl, this.classes.close)\r\n            optgroupClosableArrow.setAttribute('d', this.classes.arrowClose)\r\n          }\r\n\r\n          // Add click event listener to close\r\n          optgroupLabel.addEventListener('click', (e: MouseEvent) => {\r\n            e.preventDefault()\r\n            e.stopPropagation()\r\n\r\n            // If optgroup is closed, open it\r\n            if (optgroupEl.classList.contains(this.classes.getFirst('close'))) {\r\n              this.removeClasses(optgroupEl, this.classes.close)\r\n              this.addClasses(optgroupEl, this.classes.mainOpen)\r\n              optgroupClosableArrow.setAttribute('d', this.classes.arrowOpen)\r\n            } else {\r\n              this.removeClasses(optgroupEl, this.classes.mainOpen)\r\n              this.addClasses(optgroupEl, this.classes.close)\r\n              optgroupClosableArrow.setAttribute('d', this.classes.arrowClose)\r\n            }\r\n          })\r\n\r\n          // Append close to label\r\n          optgroupActions.appendChild(optgroupClosable)\r\n        }\r\n\r\n        // Add optgroup label\r\n        optgroupEl.appendChild(optgroupLabel)\r\n\r\n        // Loop through options\r\n        for (const option of d.options) {\r\n          optgroupEl.appendChild(this.option(new Option(option)))\r\n          fragment.appendChild(optgroupEl)\r\n        }\r\n      }\r\n\r\n      // Create option\r\n      if (d instanceof Option) {\r\n        fragment.appendChild(this.option(d as Option))\r\n      }\r\n    }\r\n\r\n    // Append fragment to list\r\n    this.content.list.appendChild(fragment)\r\n  }\r\n\r\n  // Create option div element\r\n  public option(option: Option): HTMLDivElement {\r\n    // Add hidden placeholder\r\n    if (option.placeholder) {\r\n      const placeholder = document.createElement('div')\r\n      this.addClasses(placeholder, this.classes.option)\r\n      this.addClasses(placeholder, this.classes.hide)\r\n      return placeholder\r\n    }\r\n\r\n    // Create option\r\n    const optionEl = document.createElement('div')\r\n    optionEl.dataset.id = option.id // Dataset id for identifying an option\r\n    optionEl.id = this.settings.id + '-' + option.id // Unique ID for ARIA references\r\n    this.addClasses(optionEl, this.classes.option)\r\n    optionEl.setAttribute('role', 'option') // WCAG attribute\r\n    if (option.class) {\r\n      option.class.split(' ').forEach((dataClass: string) => {\r\n        optionEl.classList.add(dataClass)\r\n      })\r\n    }\r\n    if (option.style) {\r\n      optionEl.style.cssText = option.style\r\n    }\r\n\r\n    // Set option content\r\n    if (this.settings.searchHighlight && this.content.search.input.value.trim() !== '') {\r\n      optionEl.innerHTML = this.highlightText(\r\n        option.html !== '' ? option.html : option.text,\r\n        this.content.search.input.value,\r\n        this.classes.searchHighlighter\r\n      )\r\n    } else if (option.html !== '') {\r\n      optionEl.innerHTML = option.html\r\n    } else {\r\n      optionEl.textContent = option.text\r\n    }\r\n\r\n    // Set title attribute\r\n    if (this.settings.showOptionTooltips && optionEl.textContent) {\r\n      optionEl.setAttribute('title', optionEl.textContent)\r\n    }\r\n\r\n    // If option is disabled\r\n    if (!option.display) {\r\n      this.addClasses(optionEl, this.classes.hide)\r\n    }\r\n\r\n    // If allowed to deselect, null onclick and add disabled\r\n    if (option.disabled) {\r\n      this.addClasses(optionEl, this.classes.disabled)\r\n    }\r\n\r\n    // If option is selected and hideSelectedOption is true, hide it\r\n    if (option.selected && this.settings.hideSelected) {\r\n      this.addClasses(optionEl, this.classes.hide)\r\n    }\r\n\r\n    // If option is selected\r\n    if (option.selected) {\r\n      this.addClasses(optionEl, this.classes.selected)\r\n      optionEl.setAttribute('aria-selected', 'true')\r\n      this.main.main.setAttribute('aria-activedescendant', optionEl.id)\r\n    } else {\r\n      this.removeClasses(optionEl, this.classes.selected)\r\n      optionEl.setAttribute('aria-selected', 'false')\r\n    }\r\n\r\n    // Add click event listener\r\n    optionEl.addEventListener('click', (e: MouseEvent) => {\r\n      e.preventDefault()\r\n      e.stopPropagation()\r\n\r\n      // Setup variables\r\n      const selectedOptions = this.store.getSelected()\r\n      const element = e.currentTarget as HTMLDivElement\r\n      const elementID = String(element.dataset.id)\r\n      const isCmd = e.ctrlKey || e.metaKey // Cmd (Mac) or Ctrl (Windows/Linux)\r\n\r\n      // If the option is disabled, do nothing\r\n      if (option.disabled) {\r\n        return\r\n      }\r\n\r\n      // allowDeselect only applies to single-select mode\r\n      // In multi-select, you can always toggle options on/off\r\n      if (!this.settings.isMultiple && option.selected && !this.settings.allowDeselect) {\r\n        return\r\n      }\r\n\r\n      // Prevent deselection of mandatory options\r\n      if (option.selected && option.mandatory) {\r\n        return\r\n      }\r\n\r\n      // Check limit and do nothing if limit is reached and the option is not selected\r\n      // Also check reverse for min limit and is selected (allow Cmd to bypass minSelected)\r\n      if (\r\n        (this.settings.isMultiple && this.settings.maxSelected <= selectedOptions.length && !option.selected) ||\r\n        (this.settings.isMultiple && this.settings.minSelected >= selectedOptions.length && option.selected && !isCmd)\r\n      ) {\r\n        return\r\n      }\r\n\r\n      // Setup variables\r\n      let shouldUpdate = false\r\n      const before = this.store.getSelectedOptions()\r\n      let after = [] as Option[]\r\n\r\n      // If multiple - mimic native browser multi-select behavior\r\n      if (this.settings.isMultiple) {\r\n        const isCurrentlySelected = before.some((o: Option) => o.id === elementID)\r\n        const isShift = e.shiftKey\r\n\r\n        // Shift+Click: Select range from last clicked to current\r\n        if (isShift && this.lastSelectedOption) {\r\n          const options = this.store.getDataOptions()\r\n          const lastIndex = options.findIndex((o: Option) => o.id === this.lastSelectedOption!.id)\r\n          const currentIndex = options.findIndex((o: Option) => o.id === option.id)\r\n\r\n          if (lastIndex >= 0 && currentIndex >= 0) {\r\n            const startIndex = Math.min(lastIndex, currentIndex)\r\n            const endIndex = Math.max(lastIndex, currentIndex)\r\n            const rangeOptions = options.slice(startIndex, endIndex + 1)\r\n\r\n            // Check if range would exceed maxSelected\r\n            const newSelections = rangeOptions.filter((opt) => !before.find((b) => b.id === opt.id))\r\n            if (before.length + newSelections.length <= this.settings.maxSelected) {\r\n              // Add range to existing selections\r\n              after = before.concat(newSelections)\r\n            } else {\r\n              // Range too large, keep existing selections\r\n              after = before\r\n            }\r\n          } else {\r\n            after = before\r\n          }\r\n        }\r\n        // Cmd/Ctrl+Click: Toggle selection without affecting others (keeps dropdown open)\r\n        else if (isCmd) {\r\n          if (isCurrentlySelected) {\r\n            // Deselect this option\r\n            after = before.filter((o: Option) => o.id !== elementID)\r\n          } else {\r\n            // Add this option to selection\r\n            after = before.concat(option)\r\n          }\r\n          this.lastSelectedOption = option\r\n        }\r\n        // Regular Click: Toggle this option (add/remove), will close dropdown\r\n        else {\r\n          if (isCurrentlySelected) {\r\n            // Deselect this option\r\n            after = before.filter((o: Option) => o.id !== elementID)\r\n          } else {\r\n            // Add this option to selection\r\n            after = before.concat(option)\r\n          }\r\n          this.lastSelectedOption = option\r\n        }\r\n      }\r\n\r\n      // If single\r\n      if (!this.settings.isMultiple) {\r\n        if (option.selected) {\r\n          // If selected after would remove\r\n          after = []\r\n        } else {\r\n          // If not selected after would add\r\n          after = [option]\r\n        }\r\n      }\r\n\r\n      // If no beforeOnChange is set automatically update at end\r\n      if (!this.callbacks.beforeChange) {\r\n        shouldUpdate = true\r\n      }\r\n\r\n      if (this.callbacks.beforeChange) {\r\n        // Check if beforeChange returns false\r\n        if (this.callbacks.beforeChange(after, before) === false) {\r\n          shouldUpdate = false\r\n        } else {\r\n          shouldUpdate = true\r\n        }\r\n      }\r\n\r\n      if (shouldUpdate) {\r\n        // Check if the option exists in the store\r\n        // if not run addOption callback\r\n        if (!this.store.getOptionByID(elementID)) {\r\n          this.callbacks.addOption(option)\r\n        }\r\n\r\n        // Get values from after and set as selected\r\n        this.callbacks.setSelected(\r\n          after.map((o: Option) => o.id),\r\n          false\r\n        )\r\n\r\n        // Close dropdown unless using modifier keys in multi-select\r\n        // (mimics native multi-select behavior where you can keep selecting)\r\n        const isModifierKey = e.ctrlKey || e.metaKey || e.shiftKey // Cmd/Ctrl or Shift\r\n        const shouldClose = this.settings.closeOnSelect && !(this.settings.isMultiple && isModifierKey)\r\n\r\n        if (shouldClose) {\r\n          this.callbacks.close()\r\n        }\r\n\r\n        // callback that the value has changed\r\n        if (this.callbacks.afterChange) {\r\n          this.callbacks.afterChange(after)\r\n        }\r\n      }\r\n    })\r\n\r\n    return optionEl\r\n  }\r\n\r\n  public destroy(): void {\r\n    // Clear any pending timeouts\r\n    if (this.closeAnimationTimeout) {\r\n      clearTimeout(this.closeAnimationTimeout)\r\n      this.closeAnimationTimeout = null\r\n    }\r\n\r\n    // Remove main\r\n    this.main.main.remove()\r\n\r\n    // Remove content\r\n    this.content.main.remove()\r\n  }\r\n\r\n  private highlightText(str: string, search: any, className: string) {\r\n    const searchTerm = search.trim()\r\n    if (searchTerm === '') {\r\n      return str\r\n    }\r\n\r\n    // Escape special regex characters in the search term to prevent regex injection\r\n    const escapedSearch = searchTerm.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')\r\n\r\n    // Create a temporary div to parse HTML and work with text nodes only\r\n    const tempDiv = document.createElement('div')\r\n    tempDiv.innerHTML = str\r\n\r\n    // Function to recursively process text nodes\r\n    const highlightTextNodes = (node: Node) => {\r\n      if (node.nodeType === Node.TEXT_NODE) {\r\n        const text = node.textContent || ''\r\n        const regex = new RegExp('(' + escapedSearch + ')', 'i')\r\n\r\n        if (regex.test(text)) {\r\n          // Create a temporary container for the highlighted content\r\n          const wrapper = document.createElement('span')\r\n          const parts = text.split(regex)\r\n\r\n          parts.forEach((part, index) => {\r\n            if (part && regex.test(part)) {\r\n              // This is the matched part - wrap it in mark\r\n              const mark = document.createElement('mark')\r\n              mark.className = className\r\n              mark.textContent = part\r\n              wrapper.appendChild(mark)\r\n            } else if (part) {\r\n              // This is not the matched part - keep as text\r\n              wrapper.appendChild(document.createTextNode(part))\r\n            }\r\n          })\r\n\r\n          // Replace the text node with the wrapper\r\n          node.parentNode?.replaceChild(wrapper, node)\r\n        }\r\n      } else if (node.nodeType === Node.ELEMENT_NODE) {\r\n        // Recursively process child nodes\r\n        Array.from(node.childNodes).forEach((child) => highlightTextNodes(child))\r\n      }\r\n    }\r\n\r\n    // Process all text nodes in the temporary div\r\n    Array.from(tempDiv.childNodes).forEach((node) => highlightTextNodes(node))\r\n\r\n    return tempDiv.innerHTML\r\n  }\r\n\r\n  private setContentDirection(direction: 'above' | 'below'): void {\r\n    const isAbove = direction === 'above'\r\n    const addClass = isAbove ? this.classes.dirAbove : this.classes.dirBelow\r\n    const removeClass = isAbove ? this.classes.dirBelow : this.classes.dirAbove\r\n\r\n    // Set direction classes on both main and content\r\n    this.removeClasses(this.main.main, removeClass)\r\n    this.addClasses(this.main.main, addClass)\r\n    this.removeClasses(this.content.main, removeClass)\r\n    this.addClasses(this.content.main, addClass)\r\n\r\n    // Set margin to position content\r\n    if (isAbove) {\r\n      const mainHeight = this.main.main.offsetHeight\r\n      const contentHeight = this.content.main.offsetHeight\r\n      this.content.main.style.margin = '-' + (mainHeight + contentHeight - 1) + 'px 0px 0px 0px'\r\n    } else {\r\n      this.content.main.style.margin = '-1px 0px 0px 0px'\r\n    }\r\n  }\r\n\r\n  private setContentPosition(): void {\r\n    if (this.settings.contentPosition === 'relative') {\r\n      return\r\n    }\r\n\r\n    const containerRect = this.main.main.getBoundingClientRect()\r\n    let top: number\r\n    let left: number\r\n\r\n    if (this.settings.contentPosition === 'fixed') {\r\n      // Fixed positioning - use viewport coordinates directly\r\n      top = containerRect.top + containerRect.height\r\n      left = containerRect.left\r\n    } else {\r\n      // Absolute positioning - calculate relative to offsetParent\r\n      const offsetParent = this.content.main.offsetParent as HTMLElement\r\n      const offsetParentRect = offsetParent ? offsetParent.getBoundingClientRect() : { top: 0, left: 0 }\r\n\r\n      top = containerRect.top - offsetParentRect.top + containerRect.height - (offsetParent?.clientTop || 0)\r\n      left = containerRect.left - offsetParentRect.left - (offsetParent?.clientLeft || 0)\r\n    }\r\n\r\n    this.content.main.style.top = top + 'px'\r\n    this.content.main.style.left = left + 'px'\r\n    this.content.main.style.width = containerRect.width + 'px'\r\n  }\r\n\r\n  public moveContentAbove(): void {\r\n    this.setContentDirection('above')\r\n    this.setContentPosition()\r\n  }\r\n\r\n  public moveContentBelow(): void {\r\n    this.setContentDirection('below')\r\n    this.setContentPosition()\r\n  }\r\n\r\n  public ensureElementInView(container: HTMLElement, element: HTMLElement): void {\r\n    // Determine container top and bottom\r\n    const cTop = container.scrollTop + container.offsetTop // Make sure to have offsetTop\r\n    const cBottom = cTop + container.clientHeight\r\n\r\n    // Determine element top and bottom\r\n    const eTop = element.offsetTop\r\n    const eBottom = eTop + element.clientHeight\r\n\r\n    // Check if out of view\r\n    if (eTop < cTop) {\r\n      container.scrollTop -= cTop - eTop\r\n    } else if (eBottom > cBottom) {\r\n      container.scrollTop += eBottom - cBottom\r\n    }\r\n  }\r\n\r\n  public putContent(): 'up' | 'down' {\r\n    // Get main and content height\r\n    const mainHeight = this.main.main.offsetHeight\r\n    const mainRect = this.main.main.getBoundingClientRect()\r\n    const contentHeight = this.content.main.offsetHeight\r\n\r\n    // From bottom of mainHeight figure out if content will fit below without going below the window\r\n    const spaceBelow = window.innerHeight - (mainRect.top + mainHeight)\r\n\r\n    // If space below is less than content height\r\n    if (spaceBelow <= contentHeight) {\r\n      // If space above is more than content height\r\n      if (mainRect.top > contentHeight) {\r\n        // Move content above\r\n        return 'up'\r\n      } else {\r\n        // Move content below\r\n        return 'down'\r\n      }\r\n    }\r\n\r\n    // Move content below\r\n    return 'down'\r\n  }\r\n\r\n  // Updates deselect based on item count and allowDeselect setting\r\n  public updateDeselectAll(): void {\r\n    if (!this.store || !this.settings) {\r\n      return\r\n    }\r\n    const selected = this.store.getSelectedOptions()\r\n    const hasSelectedItems = selected && selected.length > 0\r\n    const isMultiple = this.settings.isMultiple\r\n    const allowDeselect = this.settings.allowDeselect\r\n\r\n    const deselectButton = this.main.deselect.main\r\n    const hideClass = this.classes.hide\r\n\r\n    if (allowDeselect && !(isMultiple && !hasSelectedItems)) {\r\n      this.removeClasses(deselectButton, hideClass)\r\n    } else {\r\n      this.addClasses(deselectButton, hideClass)\r\n    }\r\n  }\r\n}\r\n","import { kebabCase, hasClassInTree } from './helpers'\r\nimport { Optgroup, Option } from './store'\r\n\r\nexport default class Select {\r\n  public select: HTMLSelectElement\r\n\r\n  // Mutation observer fields\r\n  public onValueChange?: (value: Option[]) => void\r\n  public onClassChange?: (classes: string[]) => void\r\n  public onDisabledChange?: (disabled: boolean) => void\r\n  public onOptionsChange?: (data: (Option | Optgroup)[]) => void\r\n  public onLabelClick?: () => void\r\n\r\n  // Change observers\r\n  private listen: boolean = false\r\n  private observer: MutationObserver | null = null\r\n  private isUpdating: boolean = false\r\n  private pendingOptionsChange: (Option | Optgroup)[] | null = null\r\n\r\n  // Event handlers for preventing native select behavior (especially on iOS Safari)\r\n  private preventNativeSelect: ((e: Event) => void) | null = null\r\n  private preventNativeSelectMousedown: ((e: Event) => void) | null = null\r\n  private preventNativeSelectFocus: ((e: Event) => void) | null = null\r\n\r\n  constructor(select: HTMLSelectElement) {\r\n    this.select = select\r\n\r\n    this.valueChange = this.valueChange.bind(this)\r\n    // Add change event listener\r\n    this.select.addEventListener('change', this.valueChange, {\r\n      // allow bubbling of event\r\n      passive: true\r\n    })\r\n\r\n    // Initiate mutation observer\r\n    this.observer = new MutationObserver(this.observeCall.bind(this))\r\n\r\n    // Start listening for changes\r\n    this.changeListen(true)\r\n  }\r\n\r\n  public enable(): void {\r\n    this.select.disabled = false\r\n  }\r\n\r\n  public disable(): void {\r\n    this.select.disabled = true\r\n  }\r\n\r\n  public hideUI(): void {\r\n    this.select.tabIndex = -1\r\n    // Visually hide but keep focusable for form validation\r\n    // Use 1px dimensions so browser validation popup can display\r\n    this.select.style.position = 'absolute'\r\n    this.select.style.width = '1px'\r\n    this.select.style.height = '1px'\r\n    this.select.style.opacity = '0'\r\n    this.select.style.overflow = 'hidden'\r\n    this.select.style.pointerEvents = 'none'\r\n    // Remove any spacing or borders that could affect layout\r\n    this.select.style.margin = '0'\r\n    this.select.style.padding = '0'\r\n    this.select.style.borderWidth = '0'\r\n    // Clip to completely hide the 1px\r\n    this.select.style.clip = 'rect(0 0 0 0)'\r\n    this.select.setAttribute('aria-hidden', 'true')\r\n\r\n    // Prevent native select from opening when label is clicked (especially on iOS Safari)\r\n    // iOS Safari programmatically focuses/clicks the select when label is clicked,\r\n    // bypassing pointer-events: none, so we need to prevent these events\r\n    // Only add listeners if they haven't been added yet\r\n    if (!this.preventNativeSelect) {\r\n      this.preventNativeSelect = (e: Event) => {\r\n        e.preventDefault()\r\n        e.stopPropagation()\r\n        e.stopImmediatePropagation()\r\n      }\r\n\r\n      this.preventNativeSelectMousedown = (e: Event) => {\r\n        e.preventDefault()\r\n        e.stopPropagation()\r\n        e.stopImmediatePropagation()\r\n      }\r\n\r\n      this.preventNativeSelectFocus = (e: Event) => {\r\n        e.preventDefault()\r\n        e.stopPropagation()\r\n        e.stopImmediatePropagation()\r\n      }\r\n\r\n      // Add event listeners with capture phase to catch events before they reach the select\r\n      this.select.addEventListener('click', this.preventNativeSelect, { capture: true, passive: false })\r\n      this.select.addEventListener('mousedown', this.preventNativeSelectMousedown, { capture: true, passive: false })\r\n      this.select.addEventListener('focus', this.preventNativeSelectFocus, { capture: true, passive: false })\r\n    }\r\n  }\r\n\r\n  public showUI(): void {\r\n    this.select.removeAttribute('tabindex')\r\n    // Reset visual hiding styles\r\n    this.select.style.position = ''\r\n    this.select.style.width = ''\r\n    this.select.style.height = ''\r\n    this.select.style.opacity = ''\r\n    this.select.style.overflow = ''\r\n    this.select.style.pointerEvents = ''\r\n    this.select.style.margin = ''\r\n    this.select.style.padding = ''\r\n    this.select.style.borderWidth = ''\r\n    this.select.style.clip = ''\r\n    this.select.removeAttribute('aria-hidden')\r\n\r\n    // Remove event listeners that prevent native select behavior\r\n    if (this.preventNativeSelect) {\r\n      this.select.removeEventListener('click', this.preventNativeSelect, { capture: true })\r\n      this.preventNativeSelect = null\r\n    }\r\n    if (this.preventNativeSelectMousedown) {\r\n      this.select.removeEventListener('mousedown', this.preventNativeSelectMousedown, { capture: true })\r\n      this.preventNativeSelectMousedown = null\r\n    }\r\n    if (this.preventNativeSelectFocus) {\r\n      this.select.removeEventListener('focus', this.preventNativeSelectFocus, { capture: true })\r\n      this.preventNativeSelectFocus = null\r\n    }\r\n  }\r\n\r\n  public changeListen(listen: boolean) {\r\n    this.listen = listen\r\n\r\n    // Start listening for changes\r\n    if (listen) {\r\n      if (this.observer) {\r\n        this.observer.observe(this.select, {\r\n          subtree: true, // subtree for optgroups options\r\n          childList: true, // children changes\r\n          attributes: true // attributes changes\r\n        })\r\n      }\r\n    }\r\n\r\n    // Stop listening for changes\r\n    if (!listen) {\r\n      if (this.observer) {\r\n        this.observer.disconnect()\r\n      }\r\n    }\r\n  }\r\n\r\n  // This function get triggers when the select value changes\r\n  // and will call the onValueChange function if it exists\r\n  public valueChange(ev: Event): boolean {\r\n    if (this.listen && this.onValueChange) {\r\n      this.onValueChange(this.getSelectedOptions())\r\n    }\r\n\r\n    // Allow bubbling back to other change event listeners\r\n    return true\r\n  }\r\n\r\n  private observeCall(mutations: MutationRecord[]): void {\r\n    // If we are not listening, do nothing.\r\n    if (!this.listen) {\r\n      return\r\n    }\r\n\r\n    let classChanged = false\r\n    let disabledChanged = false\r\n    let optgroupOptionChanged = false\r\n    let selectionChanged = false\r\n\r\n    // Loop through mutations and check various things\r\n    for (const m of mutations) {\r\n      // Check if its the select\r\n      if (m.target === this.select) {\r\n        // Check if disabled has changed\r\n        if (m.attributeName === 'disabled') {\r\n          disabledChanged = true\r\n        }\r\n\r\n        // Check if class has changed\r\n        if (m.attributeName === 'class') {\r\n          classChanged = true\r\n        }\r\n\r\n        if (m.type === 'childList') {\r\n          for (const n of Array.from(m.addedNodes)) {\r\n            if (n.nodeName === 'OPTION' && (<HTMLOptionElement>n).value === this.select.value) {\r\n              // we added a new option that's now the select value\r\n              selectionChanged = true\r\n              break\r\n            }\r\n          }\r\n\r\n          // options changed, so we need the optionsChange event to fire\r\n          optgroupOptionChanged = true\r\n        }\r\n      }\r\n\r\n      // Check if its an optgroup or option\r\n      if (m.target.nodeName === 'OPTGROUP' || m.target.nodeName === 'OPTION') {\r\n        optgroupOptionChanged = true\r\n      }\r\n    }\r\n\r\n    // If class has changed then call the class change function\r\n    if (classChanged && this.onClassChange) {\r\n      this.onClassChange(this.select.className.split(' '))\r\n    }\r\n\r\n    // If disabled has changed then call the disabled change function\r\n    if (disabledChanged && this.onDisabledChange) {\r\n      this.changeListen(false)\r\n      this.onDisabledChange(this.select.disabled)\r\n      this.changeListen(true)\r\n    }\r\n\r\n    // If optgroup or option has changed then call the select change function\r\n    if (optgroupOptionChanged && this.onOptionsChange) {\r\n      // If we're currently updating, queue this change to process after update completes\r\n      if (this.isUpdating) {\r\n        // Only queue if the select element actually has options (not empty from updateOptions clearing)\r\n        // Check the select element directly, not getData() which might return stale data\r\n        if (this.select.options.length > 0) {\r\n          const currentData = this.getData()\r\n          // Only queue if we have actual data\r\n          if (currentData.length > 0) {\r\n            this.pendingOptionsChange = currentData\r\n          }\r\n        }\r\n        if (selectionChanged) {\r\n          this.select.dispatchEvent(new Event('change'))\r\n        }\r\n        return\r\n      }\r\n\r\n      this.changeListen(false)\r\n      this.onOptionsChange(this.getData())\r\n      this.changeListen(true)\r\n    }\r\n\r\n    if (selectionChanged) {\r\n      this.select.dispatchEvent(new Event('change'))\r\n    }\r\n  }\r\n\r\n  // From the select element pull optgroup and options into data\r\n  public getData(): (Option | Optgroup)[] {\r\n    let data = []\r\n\r\n    // Loop through nodes and get data\r\n    const nodes = this.select.childNodes as any as HTMLOptGroupElement[] | HTMLOptionElement[]\r\n    for (const n of nodes) {\r\n      // Optgroup\r\n      if (n.nodeName === 'OPTGROUP') {\r\n        data.push(this.getDataFromOptgroup(n as HTMLOptGroupElement))\r\n      }\r\n\r\n      // Option\r\n      if (n.nodeName === 'OPTION') {\r\n        data.push(this.getDataFromOption(n as HTMLOptionElement))\r\n      }\r\n    }\r\n\r\n    return data\r\n  }\r\n\r\n  public getDataFromOptgroup(optgroup: HTMLOptGroupElement): Optgroup {\r\n    let data = {\r\n      id: optgroup.id,\r\n      label: optgroup.label,\r\n      selectAll: optgroup.dataset ? optgroup.dataset.selectall === 'true' : false,\r\n      selectAllText: optgroup.dataset ? optgroup.dataset.selectalltext : 'Select all',\r\n      closable: optgroup.dataset ? optgroup.dataset.closable : 'off',\r\n      options: []\r\n    } as Optgroup\r\n\r\n    const options = optgroup.childNodes as any as HTMLOptionElement[]\r\n    for (const o of options) {\r\n      if (o.nodeName === 'OPTION') {\r\n        data.options!.push(this.getDataFromOption(o as HTMLOptionElement))\r\n      }\r\n    }\r\n\r\n    return data\r\n  }\r\n\r\n  // From passed in option pull pieces of usable information\r\n  public getDataFromOption(option: HTMLOptionElement): Option {\r\n    return {\r\n      id: option.id,\r\n      value: option.value,\r\n      text: option.text,\r\n      html: option.dataset && option.dataset.html ? option.dataset.html : '',\r\n      defaultSelected: option.defaultSelected,\r\n      selected: option.selected,\r\n      display: option.style.display !== 'none',\r\n      disabled: option.disabled,\r\n      mandatory: option.dataset ? option.dataset.mandatory === 'true' : false,\r\n      placeholder: option.dataset.placeholder === 'true',\r\n      class: option.className,\r\n      style: option.style.cssText,\r\n      data: option.dataset\r\n    } as Option\r\n  }\r\n\r\n  public getSelectedOptions(): Option[] {\r\n    let options = []\r\n\r\n    // Loop through options and set selected\r\n    const opts = this.select.childNodes as any as (HTMLOptGroupElement | HTMLOptionElement)[]\r\n    for (const o of opts) {\r\n      if (o.nodeName === 'OPTGROUP') {\r\n        const optgroupOptions = o.childNodes as any as HTMLOptionElement[]\r\n        for (const oo of optgroupOptions) {\r\n          if (oo.nodeName === 'OPTION') {\r\n            const option = oo as HTMLOptionElement\r\n            if (option.selected) {\r\n              options.push(this.getDataFromOption(option))\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      if (o.nodeName === 'OPTION') {\r\n        const option = o as HTMLOptionElement\r\n        if (option.selected) {\r\n          options.push(this.getDataFromOption(option))\r\n        }\r\n      }\r\n    }\r\n\r\n    return options\r\n  }\r\n\r\n  public getSelectedValues(): string[] {\r\n    return this.getSelectedOptions().map((option) => option.value)\r\n  }\r\n\r\n  public setSelected(ids: string[]): void {\r\n    // Stop listening to changes\r\n    this.changeListen(false)\r\n\r\n    // Loop through options and set selected\r\n    const options = this.select.childNodes as any as (HTMLOptGroupElement | HTMLOptionElement)[]\r\n    for (const o of options) {\r\n      if (o.nodeName === 'OPTGROUP') {\r\n        const optgroup = o as HTMLOptGroupElement\r\n        const optgroupOptions = optgroup.childNodes as any as HTMLOptionElement[]\r\n        for (const oo of optgroupOptions) {\r\n          if (oo.nodeName === 'OPTION') {\r\n            const option = oo as HTMLOptionElement\r\n            option.selected = ids.includes(option.id)\r\n          }\r\n        }\r\n      }\r\n\r\n      if (o.nodeName === 'OPTION') {\r\n        const option = o as HTMLOptionElement\r\n        option.selected = ids.includes(option.id)\r\n      }\r\n    }\r\n\r\n    // Stop listening to changes\r\n    this.changeListen(true)\r\n  }\r\n\r\n  // Set selected options by value instead of id\r\n  // This is useful when the id is not known\r\n  // and only the value is known\r\n  // but the value is not unique and can be duplicated\r\n  public setSelectedByValue(values: string[]): void {\r\n    // Stop listening to changes\r\n    this.changeListen(false)\r\n\r\n    // Loop through options and set selected\r\n    const options = this.select.childNodes as any as (HTMLOptGroupElement | HTMLOptionElement)[]\r\n    for (const o of options) {\r\n      if (o.nodeName === 'OPTGROUP') {\r\n        const optgroup = o as HTMLOptGroupElement\r\n        const optgroupOptions = optgroup.childNodes as any as HTMLOptionElement[]\r\n        for (const oo of optgroupOptions) {\r\n          if (oo.nodeName === 'OPTION') {\r\n            const option = oo as HTMLOptionElement\r\n            option.selected = values.includes(option.value)\r\n          }\r\n        }\r\n      }\r\n\r\n      if (o.nodeName === 'OPTION') {\r\n        const option = o as HTMLOptionElement\r\n        option.selected = values.includes(option.value)\r\n      }\r\n    }\r\n\r\n    // Stop listening to changes\r\n    this.changeListen(true)\r\n  }\r\n\r\n  public updateSelect(id?: string, style?: string, classes?: string[]): void {\r\n    // Stop listening to changes\r\n    this.changeListen(false)\r\n\r\n    // Update id, only if the id isnt already set\r\n    if (id) {\r\n      this.select.dataset.id = id\r\n    }\r\n\r\n    // Update style\r\n    if (style) {\r\n      this.select.style.cssText = style\r\n    }\r\n\r\n    // Update classes\r\n    if (classes) {\r\n      this.select.className = ''\r\n      classes.forEach((c) => {\r\n        if (c.trim() !== '') {\r\n          this.select.classList.add(c.trim())\r\n        }\r\n      })\r\n    }\r\n\r\n    // Start listening to changes\r\n    this.changeListen(true)\r\n  }\r\n\r\n  public updateOptions(data: (Option | Optgroup)[]): void {\r\n    // Don't update if data is empty (prevents clearing select when no data)\r\n    if (!data || data.length === 0) {\r\n      return\r\n    }\r\n\r\n    // Set updating flag FIRST to prevent mutation observer from processing during update\r\n    // This must be set before stopping listening so any queued mutations see the flag\r\n    this.isUpdating = true\r\n    this.pendingOptionsChange = null\r\n\r\n    // Stop listening to changes\r\n    this.changeListen(false)\r\n\r\n    // Clear out select\r\n    this.select.innerHTML = ''\r\n\r\n    for (const d of data) {\r\n      if (d instanceof Optgroup) {\r\n        this.select.appendChild(this.createOptgroup(d))\r\n      }\r\n\r\n      if (d instanceof Option) {\r\n        this.select.appendChild(this.createOption(d))\r\n      }\r\n    }\r\n\r\n    // Trigger change event on original select\r\n    this.select.dispatchEvent(new Event('change', { bubbles: true }))\r\n\r\n    // Start listening to changes\r\n    this.changeListen(true)\r\n\r\n    // Clear updating flag\r\n    this.isUpdating = false\r\n\r\n    // Process any pending options change that was queued during the update\r\n    // Only process if it has data (don't process empty data from innerHTML clearing)\r\n    if (this.pendingOptionsChange !== null) {\r\n      const pending: (Option | Optgroup)[] = this.pendingOptionsChange\r\n      if (pending.length > 0 && this.onOptionsChange) {\r\n        this.pendingOptionsChange = null\r\n        // Process the queued change\r\n        this.changeListen(false)\r\n        this.onOptionsChange(pending)\r\n        this.changeListen(true)\r\n      } else {\r\n        // Clear pending if it was empty\r\n        this.pendingOptionsChange = null\r\n      }\r\n    }\r\n  }\r\n\r\n  public createOptgroup(optgroup: Optgroup): HTMLOptGroupElement {\r\n    const optgroupEl = document.createElement('optgroup')\r\n    optgroupEl.id = optgroup.id\r\n    optgroupEl.label = optgroup.label\r\n    if (optgroup.selectAll) {\r\n      optgroupEl.dataset.selectAll = 'true'\r\n    }\r\n    if (optgroup.closable !== 'off') {\r\n      optgroupEl.dataset.closable = optgroup.closable\r\n    }\r\n    if (optgroup.options) {\r\n      for (const option of optgroup.options) {\r\n        optgroupEl.appendChild(this.createOption(option as Option))\r\n      }\r\n    }\r\n    return optgroupEl\r\n  }\r\n\r\n  public createOption(info: Option): HTMLOptionElement {\r\n    const optionEl = document.createElement('option')\r\n    optionEl.id = info.id\r\n    optionEl.value = info.value\r\n    optionEl.textContent = info.text\r\n    if (info.html !== '') {\r\n      optionEl.setAttribute('data-html', info.html)\r\n    }\r\n    optionEl.defaultSelected = info.defaultSelected\r\n    optionEl.selected = info.selected // Explicitly set selected because defaultSelected: true sets selected to true\r\n    if (info.disabled) {\r\n      optionEl.disabled = true\r\n    }\r\n    if (!info.display) {\r\n      optionEl.style.display = 'none'\r\n    }\r\n    if (info.placeholder) {\r\n      optionEl.setAttribute('data-placeholder', 'true')\r\n    }\r\n    if (info.mandatory) {\r\n      optionEl.setAttribute('data-mandatory', 'true')\r\n    }\r\n    if (info.class) {\r\n      info.class.split(' ').forEach((optionClass: string) => {\r\n        optionEl.classList.add(optionClass)\r\n      })\r\n    }\r\n    if (info.data && typeof info.data === 'object') {\r\n      Object.keys(info.data).forEach((key) => {\r\n        optionEl.setAttribute('data-' + kebabCase(key), info.data[key])\r\n      })\r\n    }\r\n\r\n    return optionEl\r\n  }\r\n\r\n  // Find and handle labels associated with this select\r\n  public setupLabelHandlers(): void {\r\n    const labels: HTMLLabelElement[] = []\r\n\r\n    // Find labels that point to this select via 'for' attribute\r\n    const selectId = this.select.id\r\n    if (selectId) {\r\n      const labelsByFor = document.querySelectorAll<HTMLLabelElement>(`label[for=\"${selectId}\"]`)\r\n      labelsByFor.forEach((label) => labels.push(label))\r\n    }\r\n\r\n    // Find labels that wrap this select (label contains select)\r\n    let parent = this.select.parentElement\r\n    while (parent && parent !== document.body) {\r\n      if (parent.tagName === 'LABEL') {\r\n        labels.push(parent as HTMLLabelElement)\r\n        break\r\n      }\r\n      parent = parent.parentElement\r\n    }\r\n\r\n    // Remove duplicates\r\n    const uniqueLabels = Array.from(new Set(labels))\r\n\r\n    uniqueLabels.forEach((label) => {\r\n      // Skip if already handled\r\n      if ((label as any).__slimSelectLabelHandler) {\r\n        return\r\n      }\r\n\r\n      // Add click handler to label\r\n      const labelClickHandler = (e: MouseEvent) => {\r\n        const target = e.target as HTMLElement\r\n\r\n        // Check if click is on SlimSelect UI elements (main div or content)\r\n        const isSlimSelectElement = hasClassInTree(target, this.select.dataset.id!)\r\n\r\n        // Prevent default label behavior (focusing the select)\r\n        // This needs to happen for all clicks on the label or its children\r\n        // to prevent the browser from focusing the hidden select\r\n        e.preventDefault()\r\n        // e.stopPropagation() // dont stop propagation\r\n\r\n        // Only trigger the toggle if the click is NOT on SlimSelect elements\r\n        // This allows clicking label text/children to toggle, while wrapped SlimSelect handles its own clicks\r\n        if (!isSlimSelectElement && this.onLabelClick) {\r\n          this.onLabelClick()\r\n        }\r\n      }\r\n\r\n      // Store the handler on the label for cleanup later\r\n      ;(label as any).__slimSelectLabelHandler = labelClickHandler\r\n      label.addEventListener('click', labelClickHandler, { capture: true, passive: false })\r\n    })\r\n  }\r\n\r\n  // Remove label handlers\r\n  public removeLabelHandlers(): void {\r\n    const labels: HTMLLabelElement[] = []\r\n\r\n    // Find labels that point to this select via 'for' attribute\r\n    const selectId = this.select.id\r\n    if (selectId) {\r\n      const labelsByFor = document.querySelectorAll<HTMLLabelElement>(`label[for=\"${selectId}\"]`)\r\n      labelsByFor.forEach((label) => labels.push(label))\r\n    }\r\n\r\n    // Find labels that wrap this select\r\n    let parent = this.select.parentElement\r\n    while (parent && parent !== document.body) {\r\n      if (parent.tagName === 'LABEL') {\r\n        labels.push(parent as HTMLLabelElement)\r\n        break\r\n      }\r\n      parent = parent.parentElement\r\n    }\r\n\r\n    // Remove duplicates\r\n    const uniqueLabels = Array.from(new Set(labels))\r\n\r\n    uniqueLabels.forEach((label) => {\r\n      const handler = (label as any).__slimSelectLabelHandler\r\n      if (handler) {\r\n        label.removeEventListener('click', handler, { capture: true })\r\n        delete (label as any).__slimSelectLabelHandler\r\n      }\r\n    })\r\n  }\r\n\r\n  public destroy() {\r\n    this.changeListen(false)\r\n\r\n    // Remove event change listener\r\n    this.select.removeEventListener('change', this.valueChange)\r\n\r\n    // Remove event listeners that prevent native select behavior\r\n    if (this.preventNativeSelect) {\r\n      this.select.removeEventListener('click', this.preventNativeSelect, { capture: true })\r\n      this.preventNativeSelect = null\r\n    }\r\n    if (this.preventNativeSelectMousedown) {\r\n      this.select.removeEventListener('mousedown', this.preventNativeSelectMousedown, { capture: true })\r\n      this.preventNativeSelectMousedown = null\r\n    }\r\n    if (this.preventNativeSelectFocus) {\r\n      this.select.removeEventListener('focus', this.preventNativeSelectFocus, { capture: true })\r\n      this.preventNativeSelectFocus = null\r\n    }\r\n\r\n    // Disconnect observer and null\r\n    if (this.observer) {\r\n      this.observer.disconnect()\r\n      this.observer = null\r\n    }\r\n\r\n    // Remove label handlers\r\n    this.removeLabelHandlers()\r\n\r\n    // Remove dataset id from original select\r\n    delete this.select.dataset.id\r\n\r\n    // Show the original select\r\n    this.showUI()\r\n  }\r\n}\r\n","import { generateID } from './helpers'\r\n\r\nexport default class Settings {\r\n  public id: string = '' // Primary ID for the select\r\n  public style: string = '' // Style attribute from the select element\r\n  public class: string[] = [] // Class attribute from the select element\r\n\r\n  // Dynamic settings\r\n  public isMultiple: boolean = false\r\n  public isOpen: boolean = false\r\n  public isFullOpen: boolean = false\r\n  public intervalMove: ReturnType<typeof setInterval> | null = null\r\n\r\n  // Fields set from constructor\r\n  public disabled: boolean\r\n  public alwaysOpen: boolean\r\n  public showSearch: boolean\r\n  public focusSearch: boolean\r\n  public keepSearch: boolean\r\n  public ariaLabel: string\r\n  public searchPlaceholder: string\r\n  public searchText: string\r\n  public searchingText: string\r\n  public searchHighlight: boolean\r\n  public closeOnSelect: boolean\r\n  public contentLocation: HTMLElement | null\r\n  public contentPosition: 'relative' | 'absolute' | 'fixed'\r\n  public openPosition: 'auto' | 'up' | 'down'\r\n  public placeholderText: string\r\n  public allowDeselect: boolean\r\n  public hideSelected: boolean\r\n  public keepOrder: boolean\r\n  public showOptionTooltips: boolean\r\n  public minSelected: number\r\n  public maxSelected: number\r\n  public timeoutDelay: number\r\n  public maxValuesShown: number\r\n  public maxValuesMessage: string\r\n  public addableText: string\r\n  public addButtonText: string\r\n\r\n  constructor(settings?: Partial<Settings>) {\r\n    if (!settings) {\r\n      settings = {}\r\n    }\r\n\r\n    this.id = 'ss-' + generateID()\r\n    this.style = settings.style || ''\r\n    this.class = settings.class || []\r\n\r\n    this.disabled = settings.disabled !== undefined ? settings.disabled : false\r\n    this.alwaysOpen = settings.alwaysOpen !== undefined ? settings.alwaysOpen : false\r\n    this.showSearch = settings.showSearch !== undefined ? settings.showSearch : true\r\n    this.focusSearch = settings.focusSearch !== undefined ? settings.focusSearch : true\r\n    this.keepSearch = settings.keepSearch !== undefined ? settings.keepSearch : false\r\n    this.ariaLabel = settings.ariaLabel || 'Combobox'\r\n    this.searchPlaceholder = settings.searchPlaceholder || 'Buscar...'\r\n    this.searchText = settings.searchText || 'Sin resultados'\r\n    this.searchingText = settings.searchingText || 'Buscando...'\r\n    this.searchHighlight = settings.searchHighlight !== undefined ? settings.searchHighlight : false\r\n    this.closeOnSelect = settings.closeOnSelect !== undefined ? settings.closeOnSelect : true\r\n    this.contentLocation = settings.contentLocation || document.body\r\n    this.contentPosition = settings.contentPosition || 'absolute'\r\n    this.openPosition = settings.openPosition || 'auto' // options: auto, up, down\r\n    this.placeholderText = settings.placeholderText !== undefined ? settings.placeholderText : 'Seleccionar valor'\r\n    this.allowDeselect = settings.allowDeselect !== undefined ? settings.allowDeselect : false\r\n    this.hideSelected = settings.hideSelected !== undefined ? settings.hideSelected : false\r\n    this.keepOrder = settings.keepOrder !== undefined ? settings.keepOrder : false\r\n    this.showOptionTooltips = settings.showOptionTooltips !== undefined ? settings.showOptionTooltips : false\r\n    this.minSelected = settings.minSelected || 0\r\n    this.maxSelected = settings.maxSelected || 1000\r\n    this.timeoutDelay = settings.timeoutDelay || 200\r\n    this.maxValuesShown = settings.maxValuesShown || 20\r\n    this.maxValuesMessage = settings.maxValuesMessage || '{number} seleccionados'\r\n    this.addableText = settings.addableText || 'Pulsa \"Enter\" para aadir {value}'\r\n    this.addButtonText = settings.addButtonText || ''\r\n  }\r\n}\r\n","import CssClasses from './classes'\r\nimport { debounce, hasClassInTree, isEqual } from './helpers'\r\nimport Render from './render'\r\nimport Select from './select'\r\nimport Settings from './settings'\r\nimport Store, { Option, Optgroup } from './store'\r\n\r\n// Export classes\r\nexport { Settings, Option, Optgroup }\r\n\r\n// Export interfaces from render\r\nexport type { Main, Content, Search } from './render'\r\n\r\nexport interface Config {\r\n  select: string | Element\r\n  data?: (Partial<Option> | Partial<Optgroup>)[]\r\n  settings?: Partial<Settings>\r\n  cssClasses?: Partial<CssClasses>\r\n  events?: Events\r\n}\r\n\r\nexport interface Events {\r\n  search?: (\r\n    searchValue: string,\r\n    currentData: (Option | Optgroup)[]\r\n  ) => Promise<(Partial<Option> | Partial<Optgroup>)[]> | (Partial<Option> | Partial<Optgroup>)[]\r\n  searchFilter?: (option: Option, search: string) => boolean\r\n  addable?: (\r\n    value: string\r\n  ) => Promise<Partial<Option> | string> | Partial<Option> | string | false | null | undefined | Error\r\n  addButton?: () => void\r\n  beforeChange?: (newVal: Option[], oldVal: Option[]) => boolean | void\r\n  afterChange?: (newVal: Option[]) => void\r\n  beforeOpen?: () => void\r\n  afterOpen?: () => void\r\n  beforeClose?: () => void\r\n  afterClose?: () => void\r\n  error?: (err: Error) => void\r\n}\r\n\r\nexport default class SlimSelect {\r\n  public selectEl: HTMLSelectElement\r\n\r\n  // Classes\r\n  public settings!: Settings\r\n  public cssClasses!: CssClasses\r\n  public select!: Select\r\n  public store!: Store\r\n  public render!: Render\r\n\r\n  // Timeout tracking for cleanup\r\n  private openTimeout: ReturnType<typeof setTimeout> | null = null\r\n  private closeTimeout: ReturnType<typeof setTimeout> | null = null\r\n\r\n  // Events\r\n  public events = {\r\n    search: undefined,\r\n    searchFilter: (opt: Option, search: string) => {\r\n      return opt.text.toLowerCase().indexOf(search.toLowerCase()) !== -1\r\n    },\r\n    addable: undefined,\r\n    addButton: undefined,\r\n    beforeChange: undefined,\r\n    afterChange: undefined,\r\n    beforeOpen: undefined,\r\n    afterOpen: undefined,\r\n    beforeClose: undefined,\r\n    afterClose: undefined\r\n  } as Events\r\n\r\n  constructor(config: Config) {\r\n    // Make sure you get the right element\r\n    this.selectEl = (\r\n      typeof config.select === 'string' ? document.querySelector(config.select) : config.select\r\n    ) as HTMLSelectElement\r\n    if (!this.selectEl) {\r\n      if (config.events && config.events.error) {\r\n        config.events.error(new Error('Could not find select element'))\r\n      }\r\n      return\r\n    }\r\n    if (this.selectEl.tagName !== 'SELECT') {\r\n      if (config.events && config.events.error) {\r\n        config.events.error(new Error('Element isnt of type select'))\r\n      }\r\n      return\r\n    }\r\n\r\n    // If select already has a slim select id on it lets destroy it first\r\n    if (this.selectEl.dataset.ssid) {\r\n      this.destroy()\r\n    }\r\n\r\n    // Set settings\r\n    this.settings = new Settings(config.settings)\r\n\r\n    // Set CSS classes\r\n    this.cssClasses = new CssClasses(config.cssClasses)\r\n\r\n    // Set events\r\n    const debounceEvents = ['beforeOpen', 'afterOpen', 'beforeClose', 'afterClose']\r\n    for (const key in config.events) {\r\n      // Check if key exists in events\r\n      if (!config.events.hasOwnProperty(key)) {\r\n        continue\r\n      }\r\n\r\n      // Check if key is in debounceEvents\r\n      if (debounceEvents.indexOf(key) !== -1) {\r\n        ;(this.events as { [key: string]: any })[key] = debounce((config.events as { [key: string]: any })[key], 100)\r\n      } else {\r\n        ;(this.events as { [key: string]: any })[key] = (config.events as { [key: string]: any })[key]\r\n      }\r\n    }\r\n\r\n    // Upate settings with type, style and classname\r\n    this.settings.disabled = config.settings?.disabled ? config.settings.disabled : this.selectEl.disabled\r\n    this.settings.isMultiple = this.selectEl.multiple\r\n    this.settings.style = this.selectEl.style.cssText\r\n    this.settings.class = this.selectEl.className.split(' ')\r\n\r\n    // Set select class\r\n    this.select = new Select(this.selectEl)\r\n    // Ensure the select has an id for label associations\r\n    if (!this.selectEl.id) {\r\n      this.selectEl.id = this.settings.id\r\n    }\r\n    this.select.updateSelect(this.settings.id, this.settings.style, this.settings.class)\r\n    this.select.hideUI() // Hide the original select element\r\n\r\n    // Add select listeners\r\n    this.select.onValueChange = (options: Option[]) => {\r\n      // Run set selected from the values given\r\n      this.setSelected(options.map((option) => option.id))\r\n    }\r\n    this.select.onClassChange = (classes: string[]) => {\r\n      // Update settings with new class\r\n      this.settings.class = classes\r\n\r\n      // Run render updateClassStyles\r\n      this.render.updateClassStyles()\r\n    }\r\n    this.select.onDisabledChange = (disabled: boolean) => {\r\n      if (disabled) {\r\n        this.disable()\r\n      } else {\r\n        this.enable()\r\n      }\r\n    }\r\n    this.select.onOptionsChange = (data: (Option | Optgroup)[]) => {\r\n      // Process the data (including empty data for clearing all options)\r\n      // Empty data is safe to process here because if we were updating, the change would be queued\r\n      // and onOptionsChange wouldn't be called directly\r\n      this.setData(data || [])\r\n    }\r\n    // Set up label click handler to toggle SlimSelect\r\n    // This allows clicking the label to open/close, matching the main div behavior\r\n    this.select.onLabelClick = () => {\r\n      if (!this.settings.disabled) {\r\n        this.settings.isOpen ? this.close() : this.open()\r\n      }\r\n    }\r\n\r\n    // Set store class\r\n    const data = config.data ? config.data : this.select.getData()\r\n    this.store = new Store(this.settings.isMultiple ? 'multiple' : 'single', data)\r\n\r\n    // If data is passed update the original select element\r\n    if (config.data) {\r\n      this.select.updateOptions(this.store.getData())\r\n    }\r\n\r\n    // Set render renderCallbacks\r\n    const renderCallbacks = {\r\n      open: this.open.bind(this),\r\n      close: this.close.bind(this),\r\n      addable: this.events.addable ? this.events.addable : undefined,\r\n      addButton: this.events.addButton ? this.events.addButton : undefined,\r\n      setSelected: this.setSelected.bind(this),\r\n      addOption: this.addOption.bind(this),\r\n      search: this.search.bind(this),\r\n      beforeChange: this.events.beforeChange,\r\n      afterChange: this.events.afterChange\r\n    }\r\n\r\n    // Setup render class\r\n    this.render = new Render(this.settings, this.cssClasses, this.store, renderCallbacks)\r\n    this.render.renderValues()\r\n    this.render.renderOptions(this.store.getData())\r\n\r\n    // Add aria-label or aria-labelledby if exists\r\n    const selectAriaLabel = this.selectEl.getAttribute('aria-label')\r\n    const selectAriaLabelledBy = this.selectEl.getAttribute('aria-labelledby')\r\n\r\n    if (selectAriaLabel) {\r\n      this.render.main.main.setAttribute('aria-label', selectAriaLabel)\r\n    } else if (selectAriaLabelledBy) {\r\n      this.render.main.main.setAttribute('aria-labelledby', selectAriaLabelledBy)\r\n    }\r\n\r\n    // Add render after original select element\r\n    if (this.selectEl.parentNode) {\r\n      this.selectEl.parentNode.insertBefore(this.render.main.main, this.selectEl.nextSibling)\r\n    }\r\n\r\n    // Add window resize listener to moveContent if window size changes\r\n    window.addEventListener('resize', this.windowResize, false)\r\n\r\n    // If the user wants to show the content forcibly on a specific side,\r\n    // there is no need to listen for scroll events\r\n    if (this.settings.openPosition === 'auto') {\r\n      window.addEventListener('scroll', this.windowScroll, false)\r\n    }\r\n\r\n    // Add window visibility change listener to closeContent if window is hidden\r\n    document.addEventListener('visibilitychange', this.windowVisibilityChange)\r\n\r\n    // If disabled lets call it\r\n    if (this.settings.disabled) {\r\n      this.disable()\r\n    }\r\n\r\n    // If alwaysOpnen then open it\r\n    if (this.settings.alwaysOpen) {\r\n      this.open()\r\n    }\r\n\r\n    // Set up label handlers to open SlimSelect when label is clicked\r\n    this.select.setupLabelHandlers()\r\n\r\n    // Add SlimSelect to select element\r\n    ;(this.selectEl as any).slim = this\r\n  }\r\n\r\n  // Set to enabled and remove disabled classes\r\n  public enable(): void {\r\n    this.settings.disabled = false\r\n\r\n    this.select.enable()\r\n    this.render.enable()\r\n  }\r\n\r\n  // Set to disabled and add disabled classes\r\n  public disable(): void {\r\n    this.settings.disabled = true\r\n\r\n    this.select.disable()\r\n    this.render.disable()\r\n  }\r\n\r\n  public getData(): Option[] | Optgroup[] {\r\n    return this.store.getData()\r\n  }\r\n\r\n  public setData(data: (Partial<Option> | Partial<Optgroup>)[]): void {\r\n    // Get original selected values\r\n    const selected = this.store.getSelected()\r\n\r\n    // Validate data\r\n    const err = this.store.validateDataArray(data)\r\n    if (err) {\r\n      if (this.events.error) {\r\n        this.events.error(err)\r\n      }\r\n      return\r\n    }\r\n\r\n    // Update the store\r\n    this.store.setData(data)\r\n    const dataClean = this.store.getData()\r\n\r\n    // Update original select element\r\n    this.select.updateOptions(dataClean)\r\n\r\n    // Update the render\r\n    this.render.renderValues()\r\n    this.render.renderOptions(dataClean)\r\n\r\n    // Trigger afterChange event, if it doesnt equal the original selected values\r\n    if (this.events.afterChange && !isEqual(selected, this.store.getSelected())) {\r\n      this.events.afterChange(this.store.getSelectedOptions())\r\n    }\r\n  }\r\n\r\n  public getSelected(): string[] {\r\n    let options = this.store.getSelectedOptions()\r\n    if (this.settings.keepOrder) {\r\n      options = this.store.selectedOrderOptions(options)\r\n    }\r\n    return options.map((option) => option.value)\r\n  }\r\n\r\n  // Will take in a string or array of strings and set the selected by either the id or value\r\n  public setSelected(values: string | string[], runAfterChange = true): void {\r\n    // Get original selected values\r\n    const selected = this.store.getSelected()\r\n    const options = this.store.getDataOptions()\r\n    values = Array.isArray(values) ? values : [values]\r\n    const ids = []\r\n\r\n    // for back-compatibility support both, set by id and set by value\r\n    for (const value of values) {\r\n      if (options.find((option) => option.id == value)) {\r\n        ids.push(value)\r\n        continue\r\n      }\r\n\r\n      // if option with given id is not found try to search by value\r\n      for (const option of options.filter((option) => option.value == value)) {\r\n        ids.push(option.id)\r\n      }\r\n    }\r\n\r\n    // Update the store\r\n    this.store.setSelectedBy('id', ids)\r\n    const data = this.store.getData()\r\n\r\n    // Update the select element\r\n    this.select.updateOptions(data)\r\n\r\n    // Update the render\r\n    this.render.renderValues()\r\n\r\n    // If there is a search input value lets run through the search again\r\n    // Otherwise we will just render the options from store data\r\n    if (this.render.content.search.input.value !== '') {\r\n      this.search(this.render.content.search.input.value)\r\n    } else {\r\n      this.render.renderOptions(data)\r\n    }\r\n\r\n    // Trigger afterChange event, if it doesnt equal the original selected values\r\n    if (runAfterChange && this.events.afterChange && !isEqual(selected, this.store.getSelected())) {\r\n      this.events.afterChange(this.store.getSelectedOptions())\r\n    }\r\n  }\r\n\r\n  public addOption(option: Partial<Option>): void {\r\n    // Get original selected values\r\n    const selected = this.store.getSelected()\r\n\r\n    // Add option to store if it does not already include the option\r\n    if (!this.store.getDataOptions().some((o) => o.value === (option.value ?? option.text))) {\r\n      this.store.addOption(option)\r\n    }\r\n    const data = this.store.getData()\r\n\r\n    // Update the select element\r\n    this.select.updateOptions(data)\r\n\r\n    // Update the render\r\n    this.render.renderValues()\r\n    this.render.renderOptions(data)\r\n\r\n    // Trigger afterChange event, if it doesnt equal the original selected values\r\n    if (this.events.afterChange && !isEqual(selected, this.store.getSelected())) {\r\n      this.events.afterChange(this.store.getSelectedOptions())\r\n    }\r\n  }\r\n\r\n  public open(): void {\r\n    // Dont open if disabled\r\n    // Dont do anything if the content is already open\r\n    if (this.settings.disabled || this.settings.isOpen) {\r\n      return\r\n    }\r\n\r\n    // Clear any pending close timeout to prevent race conditions\r\n    if (this.closeTimeout) {\r\n      clearTimeout(this.closeTimeout)\r\n      this.closeTimeout = null\r\n    }\r\n\r\n    // Run beforeOpen callback\r\n    if (this.events.beforeOpen) {\r\n      this.events.beforeOpen()\r\n    }\r\n\r\n    // Tell render to open\r\n    this.render.open()\r\n\r\n    // Focus on input field only if search is enabled\r\n    if (this.settings.showSearch && this.settings.focusSearch) {\r\n      this.render.searchFocus()\r\n    }\r\n\r\n    this.settings.isOpen = true\r\n    // setTimeout is for animation completion\r\n    this.openTimeout = setTimeout(() => {\r\n      // Run afterOpen callback\r\n      if (this.events.afterOpen) {\r\n        this.events.afterOpen()\r\n      }\r\n\r\n      // Update settings\r\n      // Prevent overide if user close fast without wait full open\r\n      // For detail see issue https://github.com/brianvoe/slim-select/issues/397\r\n      if (this.settings.isOpen) {\r\n        this.settings.isFullOpen = true\r\n      }\r\n\r\n      // Add onclick listener to document to closeContent if clicked outside\r\n      document.addEventListener('click', this.documentClick)\r\n    }, this.settings.timeoutDelay)\r\n\r\n    // Start an interval to check if main has moved\r\n    // in order to keep content close to main\r\n    if (this.settings.contentPosition === 'absolute') {\r\n      if (this.settings.intervalMove) {\r\n        clearInterval(this.settings.intervalMove)\r\n      }\r\n      this.settings.intervalMove = setInterval(this.render.moveContent.bind(this.render), 500)\r\n    }\r\n  }\r\n\r\n  public close(eventType: string | null = null): void {\r\n    // Dont do anything if the content is already closed\r\n    // Dont do anything if alwaysOpen is true\r\n    if (!this.settings.isOpen || this.settings.alwaysOpen) {\r\n      return\r\n    }\r\n\r\n    // Clear any pending open timeout to prevent race conditions\r\n    if (this.openTimeout) {\r\n      clearTimeout(this.openTimeout)\r\n      this.openTimeout = null\r\n    }\r\n\r\n    // Run beforeClose calback\r\n    if (this.events.beforeClose) {\r\n      this.events.beforeClose()\r\n    }\r\n\r\n    // Tell render to close\r\n    this.render.close()\r\n\r\n    // Clear search only if not empty and keepSearch is false\r\n    if (!this.settings.keepSearch && this.render.content.search.input.value !== '') {\r\n      this.search('') // Clear search\r\n    }\r\n\r\n    // If we arent tabbing focus back on the main element\r\n    this.render.mainFocus(eventType)\r\n\r\n    // Update settings\r\n    this.settings.isOpen = false\r\n    this.settings.isFullOpen = false\r\n\r\n    // Reset the content below\r\n    this.closeTimeout = setTimeout(() => {\r\n      // Run afterClose callback\r\n      if (this.events.afterClose) {\r\n        this.events.afterClose()\r\n      }\r\n\r\n      // Add onclick listener to document to closeContent if clicked outside\r\n      document.removeEventListener('click', this.documentClick)\r\n    }, this.settings.timeoutDelay)\r\n\r\n    if (this.settings.intervalMove) {\r\n      clearInterval(this.settings.intervalMove)\r\n    }\r\n  }\r\n\r\n  // Take in string value and search current options\r\n  public search(value: string): void {\r\n    // If the passed in value is not the same as the search input value\r\n    // then lets update the search input value\r\n    if (this.render.content.search.input.value !== value) {\r\n      this.render.content.search.input.value = value\r\n    }\r\n\r\n    // If value is empty then render all options\r\n    if (value === '') {\r\n      this.render.renderOptions(this.store.getData())\r\n      return\r\n    }\r\n\r\n    // If no search event run regular search\r\n    if (!this.events.search) {\r\n      // If value is empty then render all options\r\n      const searchResults = value === '' ? this.store.getData() : this.store.search(value, this.events.searchFilter!)\r\n      this.render.renderOptions(searchResults)\r\n      return\r\n    }\r\n\r\n    // Search event exists so lets render the searching text\r\n    this.render.renderSearching()\r\n\r\n    // Based upon the search event deal with the response\r\n    const searchResp = this.events.search(value, this.store.getSelectedOptions())\r\n\r\n    // If the search event returns a promise\r\n    if (searchResp instanceof Promise) {\r\n      searchResp\r\n        .then((data: (Partial<Option> | Partial<Optgroup>)[]) => {\r\n          // Update store data with search results, preserving selected options\r\n          this.store.setData(data, true)\r\n\r\n          // Update original select element\r\n          this.select.updateOptions(this.store.getData())\r\n\r\n          // Render the updated data\r\n          this.render.renderOptions(this.store.getData())\r\n        })\r\n        .catch((err: Error | string) => {\r\n          // Update the render with error\r\n          this.render.renderError(typeof err === 'string' ? err : err.message)\r\n        })\r\n\r\n      return\r\n    } else if (Array.isArray(searchResp)) {\r\n      // Update store data with search results, preserving selected options\r\n      this.store.setData(searchResp, true)\r\n\r\n      // Update original select element\r\n      this.select.updateOptions(this.store.getData())\r\n\r\n      // Render the updated data\r\n      this.render.renderOptions(this.store.getData())\r\n    } else {\r\n      // Update the render with error\r\n      this.render.renderError('Search event must return a promise or an array of data')\r\n    }\r\n  }\r\n\r\n  public destroy(): void {\r\n    // Clear any pending timeouts\r\n    if (this.openTimeout) {\r\n      clearTimeout(this.openTimeout)\r\n      this.openTimeout = null\r\n    }\r\n    if (this.closeTimeout) {\r\n      clearTimeout(this.closeTimeout)\r\n      this.closeTimeout = null\r\n    }\r\n    if (this.settings.intervalMove) {\r\n      clearInterval(this.settings.intervalMove)\r\n      this.settings.intervalMove = null\r\n    }\r\n\r\n    // Remove all event listeners\r\n    document.removeEventListener('click', this.documentClick)\r\n    window.removeEventListener('resize', this.windowResize, false)\r\n    if (this.settings.openPosition === 'auto') {\r\n      window.removeEventListener('scroll', this.windowScroll, false)\r\n    }\r\n    document.removeEventListener('visibilitychange', this.windowVisibilityChange)\r\n\r\n    // Delete the store data\r\n    this.store.setData([])\r\n\r\n    // Remove the render\r\n    this.render.destroy()\r\n\r\n    // Show the original select element\r\n    this.select.destroy()\r\n  }\r\n\r\n  private windowResize: (e: Event) => void = debounce(() => {\r\n    if (!this.settings.isOpen && !this.settings.isFullOpen) {\r\n      return\r\n    }\r\n\r\n    this.render.moveContent()\r\n  })\r\n\r\n  // Event listener for window scrolling\r\n  private windowScroll: (e: Event) => void = debounce(() => {\r\n    // If the content is not open, there is no need to move it\r\n    if (!this.settings.isOpen && !this.settings.isFullOpen) {\r\n      return\r\n    }\r\n\r\n    this.render.moveContent()\r\n  })\r\n\r\n  // Event listener for document click\r\n  private documentClick: (e: Event) => void = (e: Event) => {\r\n    // If the content is not open, there is no need to close it\r\n    if (!this.settings.isOpen) {\r\n      return\r\n    }\r\n\r\n    // Check if the click was on the content by looking at the parents\r\n    if (e.target && !hasClassInTree(e.target as HTMLElement, this.settings.id)) {\r\n      this.close(e.type)\r\n    }\r\n  }\r\n\r\n  // Event Listener for window visibility change\r\n  private windowVisibilityChange: (e: Event) => void = () => {\r\n    if (document.hidden) {\r\n      this.close()\r\n    }\r\n  }\r\n}\r\n"],"names":["CssClasses","classes","join","a","b","name","generateID","hasClassInTree","element","className","hasClass","e","c","parentByClass","debounce","func","wait","immediate","timeout","args","context","later","callNow","isEqual","kebabCase","str","result","match","Option","option","Optgroup","optgroup","o","Store","type","data","dataObj","validationError","dataFinal","optOptions","preserveSelected","newData","selectedOptions","missingSelected","selectedOption","found","newItem","opt","addToStart","selectedType","selectedValues","firstOption","hasSelected","selectedObjects","optionValue","selectedIds","value","id","options","search","searchFilter","filter","includeOptgroup","dataSearch","newOrder","isIn","Render","settings","store","callbacks","classValue","cls","dirClass","selectedId","animationTiming","cssValue","listboxId","main","highlighted","values","deselect","shouldDelete","before","after","deselectSvg","deselectPath","arrow","arrowPath","eventType","placeholderOption","placeholderText","placeholder","selected","selectedSingle","singleValue","currentNodes","maxValuesMessage","removeNodes","node","n","d","shouldAdd","i","text","deleteDiv","deleteSvg","deletePath","list","contentAdd","svg","path","textEl","input","addable","searchReturn","highlightedEnter","plus","plusPath","inputValue","runFinish","oo","newOption","ids","addableValue","notPlaceholder","notDisabled","notHidden","query","dir","prevOption","prevParent","optgroupLabel","selectOption","selectParent","firstHighlight","listId","error","errorDiv","searchingDiv","noResults","fragment","optgroupEl","optgroupLabelText","optgroupActions","selectAll","allSelected","selectAllText","selectAllSvg","selectAllBox","selectAllCheck","currentSelected","newSelected","s","optionIds","optgroupClosable","optgroupClosableSvg","optgroupClosableArrow","optionEl","dataClass","elementID","isCmd","shouldUpdate","isCurrentlySelected","lastIndex","currentIndex","startIndex","endIndex","newSelections","isModifierKey","searchTerm","escapedSearch","tempDiv","highlightTextNodes","regex","wrapper","part","index","mark","child","direction","isAbove","addClass","removeClass","mainHeight","contentHeight","containerRect","top","left","offsetParent","offsetParentRect","container","cTop","cBottom","eTop","eBottom","mainRect","hasSelectedItems","isMultiple","allowDeselect","deselectButton","hideClass","Select","select","listen","ev","mutations","classChanged","disabledChanged","optgroupOptionChanged","selectionChanged","m","currentData","nodes","opts","optgroupOptions","style","pending","info","optionClass","key","labels","selectId","label","parent","labelClickHandler","target","isSlimSelectElement","handler","Settings","SlimSelect","config","debounceEvents","disabled","renderCallbacks","selectAriaLabel","selectAriaLabelledBy","err","dataClean","runAfterChange","searchResults","searchResp"],"mappings":"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"}